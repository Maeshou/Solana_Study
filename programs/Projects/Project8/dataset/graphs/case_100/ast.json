[
  {
    "name": "define_territory",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < DefineTerritory >",
      "coords: TerritoryCoordinates",
      "base_daily: u32"
    ],
    "attributes": [],
    "body": [
      "let atlas = & mut ctx . accounts . territory ;",
      "let now = Clock :: get () ? . unix_timestamp ;",
      "let area = coords . area () ;",
      "require ! (area >= 100 , ErrorCode :: TooSmall) ;",
      "require ! (area <= 10_000 , ErrorCode :: TooLarge) ;",
      "atlas . owner = ctx . accounts . guild_master . key () ;",
      "atlas . coords = coords . clone () ;",
      "atlas . created_at = now ;",
      "atlas . size = area ;",
      "atlas . tier = TerritoryTier :: Outpost ;",
      "if area >= 2_000",
      "{",
      "atlas . tier = TerritoryTier :: City ;",
      "}",
      "if area >= 5_000",
      "{",
      "atlas . tier = TerritoryTier :: Capital ;",
      "}",
      "let mut daily = base_daily . max (10) ;",
      "let bias1 = (coords . north_boundary as i64 - coords . south_boundary as i64) . unsigned_abs () as u32 ;",
      "let bias2 = (coords . east_boundary as i64 - coords . west_boundary as i64) . unsigned_abs () as u32 ;",
      "daily = daily . saturating_add ((bias1 % 13) + (bias2 % 7)) ;",
      "if matches_capital (& atlas . tier)",
      "{",
      "daily = daily . saturating_add (200) ;",
      "}",
      "if matches_city (& atlas . tier)",
      "{",
      "daily = daily . saturating_add (90) ;",
      "}",
      "if matches_outpost (& atlas . tier)",
      "{",
      "daily = daily . saturating_add (30) ;",
      "}",
      "atlas . daily_baseline = daily ;",
      "let seed_mix = ((now as u64) . rotate_left (11)) ^ ((area as u64) . rotate_left (3)) ;",
      "atlas . shuffle_seed = seed_mix ;",
      "Ok (())"
    ]
  },
  {
    "name": "matches_capital",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "t: & TerritoryTier"
    ],
    "attributes": [],
    "body": [
      "matches ! (t , TerritoryTier :: Capital)"
    ]
  },
  {
    "name": "matches_city",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "t: & TerritoryTier"
    ],
    "attributes": [],
    "body": [
      "matches ! (t , TerritoryTier :: City)"
    ]
  },
  {
    "name": "matches_outpost",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "t: & TerritoryTier"
    ],
    "attributes": [],
    "body": [
      "matches ! (t , TerritoryTier :: Outpost)"
    ]
  },
  {
    "name": "DefineTerritory",
    "node_type": "struct",
    "fields": [
      {
        "name": "territory",
        "attribute": "# [account (init , payer = guild_master , space = 8 + Territory :: MAX_SPACE , seeds = [b\"territory\" , guild_master . key () . as_ref ()] , bump)]",
        "field_type": "Account < 'info , Territory >"
      },
      {
        "name": "guild_master",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Territory",
    "node_type": "struct",
    "fields": [
      {
        "name": "owner",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "coords",
        "attribute": null,
        "field_type": "TerritoryCoordinates"
      },
      {
        "name": "size",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "tier",
        "attribute": null,
        "field_type": "TerritoryTier"
      },
      {
        "name": "created_at",
        "attribute": null,
        "field_type": "i64"
      },
      {
        "name": "daily_baseline",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "shuffle_seed",
        "attribute": null,
        "field_type": "u64"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "TerritoryCoordinates",
    "node_type": "struct",
    "fields": [
      {
        "name": "north_boundary",
        "attribute": null,
        "field_type": "i32"
      },
      {
        "name": "south_boundary",
        "attribute": null,
        "field_type": "i32"
      },
      {
        "name": "east_boundary",
        "attribute": null,
        "field_type": "i32"
      },
      {
        "name": "west_boundary",
        "attribute": null,
        "field_type": "i32"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]