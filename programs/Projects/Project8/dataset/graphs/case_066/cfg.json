[
  {
    "name": "generate_dungeon_instance",
    "nodes": [
      {
        "id": 0,
        "label": "Entry"
      },
      {
        "id": 1,
        "label": "let dungeon_instance = & mut ctx . accounts . dungeon_instance ;"
      },
      {
        "id": 2,
        "label": "let clock = Clock :: get () ? ;"
      },
      {
        "id": 3,
        "label": "let current_timestamp = clock . unix_timestamp ;"
      },
      {
        "id": 4,
        "label": "dungeon_instance . instance_creator = ctx . accounts . party_leader . key () ;"
      },
      {
        "id": 5,
        "label": "dungeon_instance . creation_time = current_timestamp ;"
      },
      {
        "id": 6,
        "label": "dungeon_instance . difficulty_level = dungeon_difficulty . clone () ;"
      },
      {
        "id": 7,
        "label": "dungeon_instance . party_members = party_composition . clone () ;"
      },
      {
        "id": 8,
        "label": "dungeon_instance . entrance_fee = entrance_fee_paid ;"
      },
      {
        "id": 9,
        "label": "let party_size = party_composition . len () ;"
      },
      {
        "id": 10,
        "label": "require ! (party_size >= 1 , DungeonError :: PartyTooSmall) ;"
      },
      {
        "id": 11,
        "label": "require ! (party_size <= 6 , DungeonError :: PartyTooLarge) ;"
      },
      {
        "id": 12,
        "label": "let base_monster_count = match dungeon_difficulty { DungeonDifficulty :: Beginner => { dungeon_instance . recommended_level_range = (1 , 10) ; dungeon_instance . completion_time_limit = 1800 ; dungeon_instance . base_experience_reward = 500 ; 15 } , DungeonDifficulty :: Intermediate => { dungeon_instance . recommended_level_range = (11 , 25) ; dungeon_instance . completion_time_limit = 2700 ; dungeon_instance . base_experience_reward = 1200 ; 25 } , DungeonDifficulty :: Advanced => { dungeon_instance . recommended_level_range = (26 , 40) ; dungeon_instance . completion_time_limit = 3600 ; dungeon_instance . base_experience_reward = 2500 ; 35 } , DungeonDifficulty :: Expert => { dungeon_instance . recommended_level_range = (41 , 60) ; dungeon_instance . completion_time_limit = 4500 ; dungeon_instance . base_experience_reward = 4000 ; 50 } , DungeonDifficulty :: Legendary => { dungeon_instance . recommended_level_range = (61 , 100) ; dungeon_instance . completion_time_limit = 5400 ; dungeon_instance . base_experience_reward = 7500 ; 75 } , } ;"
      },
      {
        "id": 13,
        "label": "let mut monster_encounters = Vec :: new () ;"
      },
      {
        "id": 14,
        "label": "let monster_types = [MonsterType :: Goblin , MonsterType :: Skeleton , MonsterType :: Orc , MonsterType :: Dragon , MonsterType :: Demon , MonsterType :: Elemental] ;"
      },
      {
        "id": 15,
        "label": "Loop Start"
      },
      {
        "id": 16,
        "label": "let monster_type_index = (encounter_id + current_timestamp as u32) % monster_types . len () as u32 ;"
      },
      {
        "id": 17,
        "label": "let selected_monster_type = monster_types [monster_type_index as usize] . clone () ;"
      },
      {
        "id": 18,
        "label": "let (base_health , base_attack , base_defense) = match selected_monster_type { MonsterType :: Goblin => (80 , 25 , 15) , MonsterType :: Skeleton => (120 , 30 , 20) , MonsterType :: Orc => (200 , 45 , 35) , MonsterType :: Dragon => (800 , 120 , 80) , MonsterType :: Demon => (600 , 100 , 60) , MonsterType :: Elemental => (400 , 80 , 40) , } ;"
      },
      {
        "id": 19,
        "label": "let difficulty_multiplier = match dungeon_difficulty { DungeonDifficulty :: Beginner => 100 , DungeonDifficulty :: Intermediate => 150 , DungeonDifficulty :: Advanced => 200 , DungeonDifficulty :: Expert => 300 , DungeonDifficulty :: Legendary => 500 , } ;"
      },
      {
        "id": 20,
        "label": "let adjusted_health = (base_health * difficulty_multiplier) / 100 ;"
      },
      {
        "id": 21,
        "label": "let adjusted_attack = (base_attack * difficulty_multiplier) / 100 ;"
      },
      {
        "id": 22,
        "label": "let adjusted_defense = (base_defense * difficulty_multiplier) / 100 ;"
      },
      {
        "id": 23,
        "label": "let mut special_abilities = Vec :: new () ;"
      },
      {
        "id": 24,
        "label": "match selected_monster_type { MonsterType :: Dragon => { special_abilities . push (\"Fire Breath\" . to_string ()) ; special_abilities . push (\"Wing Buffet\" . to_string ()) ; special_abilities . push (\"Tail Sweep\" . to_string ()) ; } , MonsterType :: Demon => { special_abilities . push (\"Dark Magic\" . to_string ()) ; special_abilities . push (\"Soul Drain\" . to_string ()) ; } , MonsterType :: Elemental => { special_abilities . push (\"Elemental Burst\" . to_string ()) ; special_abilities . push (\"Nature's Wrath\" . to_string ()) ; } , _ => { special_abilities . push (\"Basic Attack\" . to_string ()) ; } }"
      },
      {
        "id": 25,
        "label": "monster_encounters . push (MonsterEncounter { encounter_id , monster_type : selected_monster_type , health_points : adjusted_health , attack_power : adjusted_attack , defense_rating : adjusted_defense , special_abilities , loot_tier : match adjusted_health { hp if hp >= 1000 => LootTier :: Legendary , hp if hp >= 500 => LootTier :: Epic , hp if hp >= 200 => LootTier :: Rare , _ => LootTier :: Common , } , defeated : false , }) ;"
      },
      {
        "id": 26,
        "label": "Loop End"
      },
      {
        "id": 27,
        "label": "dungeon_instance . monster_encounters = monster_encounters ;"
      },
      {
        "id": 28,
        "label": "let mut treasure_chests = Vec :: new () ;"
      },
      {
        "id": 29,
        "label": "let chest_count = (party_size * 2) + match dungeon_difficulty { DungeonDifficulty :: Legendary => 8 , DungeonDifficulty :: Expert => 6 , DungeonDifficulty :: Advanced => 4 , DungeonDifficulty :: Intermediate => 3 , DungeonDifficulty :: Beginner => 2 , } ;"
      },
      {
        "id": 30,
        "label": "Loop Start"
      },
      {
        "id": 31,
        "label": "let chest_rarity = match (chest_id + current_timestamp as usize) % 100 { value if value >= 95 => ChestRarity :: Mythical , value if value >= 85 => ChestRarity :: Legendary , value if value >= 65 => ChestRarity :: Epic , value if value >= 35 => ChestRarity :: Rare , _ => ChestRarity :: Common , } ;"
      },
      {
        "id": 32,
        "label": "let item_count = match chest_rarity { ChestRarity :: Mythical => 5 , ChestRarity :: Legendary => 4 , ChestRarity :: Epic => 3 , ChestRarity :: Rare => 2 , ChestRarity :: Common => 1 , } ;"
      },
      {
        "id": 33,
        "label": "let mut potential_items = Vec :: new () ;"
      },
      {
        "id": 34,
        "label": "Loop Start"
      },
      {
        "id": 35,
        "label": "potential_items . push (LootItem { item_name : format ! (\"Item_{}\" , chest_id * item_count + item_slot) , item_type : match item_slot % 5 { 0 => ItemType :: Weapon , 1 => ItemType :: Armor , 2 => ItemType :: Accessory , 3 => ItemType :: Consumable , _ => ItemType :: Material , } , rarity : chest_rarity . clone () , stat_bonuses : StatBonuses { strength_bonus : (chest_id as u32 + 1) * 5 , agility_bonus : (chest_id as u32 + 1) * 3 , intelligence_bonus : (chest_id as u32 + 1) * 4 , defense_bonus : (chest_id as u32 + 1) * 2 , } , market_value : match chest_rarity { ChestRarity :: Mythical => 10000 , ChestRarity :: Legendary => 5000 , ChestRarity :: Epic => 2000 , ChestRarity :: Rare => 800 , ChestRarity :: Common => 200 , } , }) ;"
      },
      {
        "id": 36,
        "label": "Loop End"
      },
      {
        "id": 37,
        "label": "treasure_chests . push (TreasureChest { chest_id : chest_id as u32 , rarity : chest_rarity , location_hint : format ! (\"Hidden near encounter {}\" , chest_id % base_monster_count) , lock_difficulty : match dungeon_difficulty { DungeonDifficulty :: Legendary => 90 , DungeonDifficulty :: Expert => 75 , DungeonDifficulty :: Advanced => 60 , DungeonDifficulty :: Intermediate => 40 , DungeonDifficulty :: Beginner => 25 , } , contained_items : potential_items , discovered : false , opened : false , }) ;"
      },
      {
        "id": 38,
        "label": "Loop End"
      },
      {
        "id": 39,
        "label": "dungeon_instance . treasure_chests = treasure_chests ;"
      },
      {
        "id": 40,
        "label": "dungeon_instance . completion_status = CompletionStatus :: InProgress ;"
      },
      {
        "id": 41,
        "label": "dungeon_instance . rooms_cleared = 0 ;"
      },
      {
        "id": 42,
        "label": "dungeon_instance . total_rooms = base_monster_count + (chest_count / 2) ;"
      },
      {
        "id": 43,
        "label": "Ok (())"
      }
    ],
    "edges": [
      {
        "from": 0,
        "to": 1,
        "label": "next"
      },
      {
        "from": 1,
        "to": 2,
        "label": "next"
      },
      {
        "from": 2,
        "to": 3,
        "label": "next"
      },
      {
        "from": 3,
        "to": 4,
        "label": "next"
      },
      {
        "from": 4,
        "to": 5,
        "label": "next"
      },
      {
        "from": 5,
        "to": 6,
        "label": "next"
      },
      {
        "from": 6,
        "to": 7,
        "label": "next"
      },
      {
        "from": 7,
        "to": 8,
        "label": "next"
      },
      {
        "from": 8,
        "to": 9,
        "label": "next"
      },
      {
        "from": 9,
        "to": 10,
        "label": "next"
      },
      {
        "from": 10,
        "to": 11,
        "label": "next"
      },
      {
        "from": 11,
        "to": 12,
        "label": "next"
      },
      {
        "from": 12,
        "to": 13,
        "label": "next"
      },
      {
        "from": 13,
        "to": 14,
        "label": "next"
      },
      {
        "from": 14,
        "to": 15,
        "label": "next"
      },
      {
        "from": 15,
        "to": 16,
        "label": "next"
      },
      {
        "from": 16,
        "to": 17,
        "label": "next"
      },
      {
        "from": 17,
        "to": 18,
        "label": "next"
      },
      {
        "from": 18,
        "to": 19,
        "label": "next"
      },
      {
        "from": 19,
        "to": 20,
        "label": "next"
      },
      {
        "from": 20,
        "to": 21,
        "label": "next"
      },
      {
        "from": 21,
        "to": 22,
        "label": "next"
      },
      {
        "from": 22,
        "to": 23,
        "label": "next"
      },
      {
        "from": 23,
        "to": 24,
        "label": "next"
      },
      {
        "from": 24,
        "to": 25,
        "label": "next"
      },
      {
        "from": 15,
        "to": 26,
        "label": "for"
      },
      {
        "from": 26,
        "to": 27,
        "label": "next"
      },
      {
        "from": 27,
        "to": 28,
        "label": "next"
      },
      {
        "from": 28,
        "to": 29,
        "label": "next"
      },
      {
        "from": 29,
        "to": 30,
        "label": "next"
      },
      {
        "from": 30,
        "to": 31,
        "label": "next"
      },
      {
        "from": 31,
        "to": 32,
        "label": "next"
      },
      {
        "from": 32,
        "to": 33,
        "label": "next"
      },
      {
        "from": 33,
        "to": 34,
        "label": "next"
      },
      {
        "from": 34,
        "to": 35,
        "label": "next"
      },
      {
        "from": 34,
        "to": 36,
        "label": "for"
      },
      {
        "from": 36,
        "to": 37,
        "label": "next"
      },
      {
        "from": 30,
        "to": 38,
        "label": "for"
      },
      {
        "from": 38,
        "to": 39,
        "label": "next"
      },
      {
        "from": 39,
        "to": 40,
        "label": "next"
      },
      {
        "from": 40,
        "to": 41,
        "label": "next"
      },
      {
        "from": 41,
        "to": 42,
        "label": "next"
      },
      {
        "from": 42,
        "to": 43,
        "label": "next"
      }
    ]
  }
]