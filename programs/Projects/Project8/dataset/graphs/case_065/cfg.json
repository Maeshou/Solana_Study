[
  {
    "name": "establish_guild_territory",
    "nodes": [
      {
        "id": 0,
        "label": "Entry"
      },
      {
        "id": 1,
        "label": "let guild_account = & mut ctx . accounts . guild_account ;"
      },
      {
        "id": 2,
        "label": "let current_time = Clock :: get () ? . unix_timestamp ;"
      },
      {
        "id": 3,
        "label": "guild_account . guild_master = ctx . accounts . guild_master . key () ;"
      },
      {
        "id": 4,
        "label": "guild_account . name = guild_name ;"
      },
      {
        "id": 5,
        "label": "guild_account . establishment_date = current_time ;"
      },
      {
        "id": 6,
        "label": "guild_account . member_count = 1 ;"
      },
      {
        "id": 7,
        "label": "guild_account . territory = territory_coordinates ;"
      },
      {
        "id": 8,
        "label": "guild_account . treasury_balance = initial_defense_budget ;"
      },
      {
        "id": 9,
        "label": "let territory_size = territory_coordinates . calculate_area () ;"
      },
      {
        "id": 10,
        "label": "require ! (territory_size >= 100 , GuildError :: TerritoryTooSmall) ;"
      },
      {
        "id": 11,
        "label": "require ! (territory_size <= 10000 , GuildError :: TerritoryTooLarge) ;"
      },
      {
        "id": 12,
        "label": "let mut defense_structures = Vec :: new () ;"
      },
      {
        "id": 13,
        "label": "let structure_count = match territory_size { size if size >= 5000 => { guild_account . max_member_capacity = 50 ; guild_account . daily_resource_generation = 1000 ; guild_account . territory_tier = TerritoryTier :: Capital ; for structure_id in 0 .. 8 { defense_structures . push (DefenseStructure { structure_id , structure_type : match structure_id % 4 { 0 => StructureType :: Watchtower , 1 => StructureType :: BarricadeWall , 2 => StructureType :: MagicBarrier , _ => StructureType :: TrapField , } , health_points : 2000 , defense_power : 300 , maintenance_cost : 50 , last_upgrade : current_time , }) ; } 8 } , size if size >= 2000 => { guild_account . max_member_capacity = 30 ; guild_account . daily_resource_generation = 500 ; guild_account . territory_tier = TerritoryTier :: City ; for structure_id in 0 .. 5 { defense_structures . push (DefenseStructure { structure_id , structure_type : match structure_id % 3 { 0 => StructureType :: Watchtower , 1 => StructureType :: BarricadeWall , _ => StructureType :: MagicBarrier , } , health_points : 1500 , defense_power : 200 , maintenance_cost : 30 , last_upgrade : current_time , }) ; } 5 } , _ => { guild_account . max_member_capacity = 15 ; guild_account . daily_resource_generation = 200 ; guild_account . territory_tier = TerritoryTier :: Outpost ; for structure_id in 0 .. 3 { defense_structures . push (DefenseStructure { structure_id , structure_type : match structure_id { 0 => StructureType :: Watchtower , 1 => StructureType :: BarricadeWall , _ => StructureType :: TrapField , } , health_points : 1000 , defense_power : 150 , maintenance_cost : 20 , last_upgrade : current_time , }) ; } 3 } } ;"
      },
      {
        "id": 14,
        "label": "guild_account . defense_structures = defense_structures ;"
      },
      {
        "id": 15,
        "label": "let mut resource_nodes = Vec :: new () ;"
      },
      {
        "id": 16,
        "label": "let available_resources = [ResourceType :: Gold , ResourceType :: Crystal , ResourceType :: Wood , ResourceType :: Stone , ResourceType :: MagicEssence] ;"
      },
      {
        "id": 17,
        "label": "Loop Start"
      },
      {
        "id": 18,
        "label": "let generation_rate = match guild_account . territory_tier { TerritoryTier :: Capital => 100 + (node_index as u32 * 20) , TerritoryTier :: City => 60 + (node_index as u32 * 15) , TerritoryTier :: Outpost => 30 + (node_index as u32 * 10) , } ;"
      },
      {
        "id": 19,
        "label": "resource_nodes . push (ResourceNode { resource_type : resource_type . clone () , current_amount : 0 , generation_rate , capacity : generation_rate * 24 , last_harvest : current_time , enhancement_level : 0 , }) ;"
      },
      {
        "id": 20,
        "label": "Loop End"
      },
      {
        "id": 21,
        "label": "guild_account . resource_nodes = resource_nodes ;"
      },
      {
        "id": 22,
        "label": "guild_account . alliance_relationships = Vec :: new () ;"
      },
      {
        "id": 23,
        "label": "guild_account . war_declarations = Vec :: new () ;"
      },
      {
        "id": 24,
        "label": "guild_account . territory_disputes = Vec :: new () ;"
      },
      {
        "id": 25,
        "label": "guild_account . guild_bonuses = GuildBonuses { experience_multiplier : 110 , resource_bonus : 105 , defense_bonus : 100 , attack_bonus : 100 , } ;"
      },
      {
        "id": 26,
        "label": "Ok (())"
      }
    ],
    "edges": [
      {
        "from": 0,
        "to": 1,
        "label": "next"
      },
      {
        "from": 1,
        "to": 2,
        "label": "next"
      },
      {
        "from": 2,
        "to": 3,
        "label": "next"
      },
      {
        "from": 3,
        "to": 4,
        "label": "next"
      },
      {
        "from": 4,
        "to": 5,
        "label": "next"
      },
      {
        "from": 5,
        "to": 6,
        "label": "next"
      },
      {
        "from": 6,
        "to": 7,
        "label": "next"
      },
      {
        "from": 7,
        "to": 8,
        "label": "next"
      },
      {
        "from": 8,
        "to": 9,
        "label": "next"
      },
      {
        "from": 9,
        "to": 10,
        "label": "next"
      },
      {
        "from": 10,
        "to": 11,
        "label": "next"
      },
      {
        "from": 11,
        "to": 12,
        "label": "next"
      },
      {
        "from": 12,
        "to": 13,
        "label": "next"
      },
      {
        "from": 13,
        "to": 14,
        "label": "next"
      },
      {
        "from": 14,
        "to": 15,
        "label": "next"
      },
      {
        "from": 15,
        "to": 16,
        "label": "next"
      },
      {
        "from": 16,
        "to": 17,
        "label": "next"
      },
      {
        "from": 17,
        "to": 18,
        "label": "next"
      },
      {
        "from": 18,
        "to": 19,
        "label": "next"
      },
      {
        "from": 17,
        "to": 20,
        "label": "for"
      },
      {
        "from": 20,
        "to": 21,
        "label": "next"
      },
      {
        "from": 21,
        "to": 22,
        "label": "next"
      },
      {
        "from": 22,
        "to": 23,
        "label": "next"
      },
      {
        "from": 23,
        "to": 24,
        "label": "next"
      },
      {
        "from": 24,
        "to": 25,
        "label": "next"
      },
      {
        "from": 25,
        "to": 26,
        "label": "next"
      }
    ]
  }
]