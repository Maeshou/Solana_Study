[
  {
    "name": "claim_referral",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < ClaimReferral >"
    ],
    "attributes": [
      "# [doc = \" 友人紹介報酬を請求するが、\"]",
      "# [doc = \" has_one = reward_vault と has_one = config のみ検証され、\"]",
      "# [doc = \" 本来必要な has_one = referrer が欠落しているため、\"]",
      "# [doc = \" 攻撃者が他人の紹介アカウントで報酬を横取りできる\"]"
    ],
    "body": [
      "let acct = & mut ctx . accounts . referral_account ;",
      "let cfg = & ctx . accounts . config ;",
      "acct . total_rewards = acct . total_rewards + cfg . reward_amount ;",
      "acct . claim_count = acct . claim_count + 1 ;",
      "Ok (())"
    ]
  },
  {
    "name": "reset_referral",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < ClaimReferral >"
    ],
    "attributes": [
      "# [doc = \" 紹介報酬データを管理者がリセットするが、\"]",
      "# [doc = \" 同様に referrer 照合がなく誰でも実行可能\"]"
    ],
    "body": [
      "let acct = & mut ctx . accounts . referral_account ;",
      "acct . total_rewards = 0 ;",
      "acct . claim_count = 0 ;",
      "Ok (())"
    ]
  },
  {
    "name": "ClaimReferral",
    "node_type": "struct",
    "fields": [
      {
        "name": "referral_account",
        "attribute": "# [account (mut , has_one = reward_vault , has_one = config)]",
        "field_type": "Account < 'info , ReferralAccount >"
      },
      {
        "name": "reward_vault",
        "attribute": "# [doc = \" 報酬を保管する Lamports プール\"]",
        "field_type": "AccountInfo < 'info >"
      },
      {
        "name": "config",
        "attribute": "# [doc = \" 紹介報酬設定アカウント\"]",
        "field_type": "Account < 'info , ReferralConfig >"
      },
      {
        "name": "referrer",
        "attribute": "# [doc = \" 紹介者（署名者・所有者照合が欠落）\"]",
        "field_type": "Signer < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "ReferralAccount",
    "node_type": "struct",
    "fields": [
      {
        "name": "referrer",
        "attribute": "# [doc = \" 本来この紹介報酬を所有するべき紹介者の Pubkey\"]",
        "field_type": "Pubkey"
      },
      {
        "name": "reward_vault",
        "attribute": "# [doc = \" 報酬を保管するプールの Pubkey\"]",
        "field_type": "Pubkey"
      },
      {
        "name": "config",
        "attribute": "# [doc = \" 設定アカウントの Pubkey\"]",
        "field_type": "Pubkey"
      },
      {
        "name": "total_rewards",
        "attribute": "# [doc = \" これまでに加算された総報酬\"]",
        "field_type": "u64"
      },
      {
        "name": "claim_count",
        "attribute": "# [doc = \" これまでの請求回数\"]",
        "field_type": "u64"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "ReferralConfig",
    "node_type": "struct",
    "fields": [
      {
        "name": "reward_amount",
        "attribute": "# [doc = \" 1 回の請求で付与する報酬量（Lamports）\"]",
        "field_type": "u64"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]