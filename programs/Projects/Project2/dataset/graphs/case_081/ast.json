[
  {
    "name": "init",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < InitMulti >",
      "initial: u64"
    ],
    "attributes": [
      "# [doc = \" 初期化：管理者と記録者を登録し、履歴に最初の値を追加\"]"
    ],
    "body": [
      "let rec = & mut ctx . accounts . record ;",
      "rec . value = initial ;",
      "rec . manager = ctx . accounts . manager . key () ;",
      "rec . writer = ctx . accounts . writer . key () ;",
      "rec . history = vec ! [initial] ;",
      "emit ! (RecordCreated { by : rec . manager , value : initial }) ;",
      "Ok (())"
    ]
  },
  {
    "name": "append_and_close",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < AppendClose >",
      "extra: u64"
    ],
    "attributes": [
      "# [doc = \" 追記＆閉鎖：記録者の署名でのみ呼び出せ、最後に残高を管理者に返却してアカウントを無効化\"]"
    ],
    "body": [
      "let rec = & mut ctx . accounts . record ;",
      "require_keys_eq ! (rec . writer , ctx . accounts . writer . key ()) ;",
      "let new_val = rec . value . checked_add (extra) . ok_or (ErrorCode :: Overflow) ? ;",
      "rec . value = new_val ;",
      "rec . history . push (new_val) ;",
      "emit ! (Appended { by : rec . writer , value : new_val }) ;",
      "let record_ai = ctx . accounts . record . to_account_info () ;",
      "let manager_ai = ctx . accounts . manager_lamports . to_account_info () ;",
      "* * manager_ai . lamports . borrow_mut () += * * record_ai . lamports . borrow () ;",
      "* * record_ai . lamports . borrow_mut () = 0 ;",
      "Ok (())"
    ]
  },
  {
    "name": "InitMulti",
    "node_type": "struct",
    "fields": [
      {
        "name": "record",
        "attribute": "# [account (init , payer = payer , space = 8 + 8 + 32 + 32 + 4 + (8 * 10))]",
        "field_type": "Account < 'info , MultiRecord >"
      },
      {
        "name": "payer",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "manager",
        "attribute": null,
        "field_type": "Signer < 'info >"
      },
      {
        "name": "writer",
        "attribute": null,
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "AppendClose",
    "node_type": "struct",
    "fields": [
      {
        "name": "record",
        "attribute": "# [account (mut , has_one = manager , has_one = writer)]",
        "field_type": "Account < 'info , MultiRecord >"
      },
      {
        "name": "writer",
        "attribute": null,
        "field_type": "Signer < 'info >"
      },
      {
        "name": "manager_lamports",
        "attribute": "# [doc = \" CHECK: lamports を返却する先\"] # [account (mut)]",
        "field_type": "AccountInfo < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "MultiRecord",
    "node_type": "struct",
    "fields": [
      {
        "name": "value",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "manager",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "writer",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "history",
        "attribute": null,
        "field_type": "Vec < u64 >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "RecordCreated",
    "node_type": "struct",
    "fields": [
      {
        "name": "by",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "value",
        "attribute": null,
        "field_type": "u64"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Appended",
    "node_type": "struct",
    "fields": [
      {
        "name": "by",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "value",
        "attribute": null,
        "field_type": "u64"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]