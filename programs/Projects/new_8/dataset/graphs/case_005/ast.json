[
  {
    "name": "write_score",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < WriteScore >",
      "user_tag: [u8 ; 8]",
      "score: u32",
      "bump: u8"
    ],
    "attributes": [],
    "body": [
      "let mut tag = user_tag ;",
      "let mut weight : u32 = 1 ;",
      "for i in 0 .. tag . len ()",
      "{",
      "if tag [i] . is_ascii_lowercase ()",
      "{",
      "tag [i] = tag [i] - 32 ;",
      "} weight = weight . wrapping_mul (131) . wrapping_add (tag [i] as u32) ;",
      "}",
      "let seeds = [& ctx . accounts . admin . key () . to_bytes () [..] , & tag [..]] ;",
      "let addr = Pubkey :: create_program_address (& seeds , & ctx . program_id , & [bump]) . map_err (| _ | error ! (ScoreError :: BadCell)) ? ;",
      "if addr != ctx . accounts . score_cell . key ()",
      "{",
      "return Err (error ! (ScoreError :: BadCell)) ;",
      "}",
      "let mut s = score ;",
      "if s > 100000",
      "{",
      "s = 100000 ;",
      "}",
      "let entry = & mut ctx . accounts . entry ;",
      "entry . admin = ctx . accounts . admin . key () ;",
      "entry . tag = tag ;",
      "entry . points = entry . points . saturating_add (s) ;",
      "entry . bias = entry . bias . wrapping_add (weight) ;",
      "Ok (())"
    ]
  },
  {
    "name": "WriteScore",
    "node_type": "struct",
    "fields": [
      {
        "name": "entry",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , ScoreEntry >"
      },
      {
        "name": "score_cell",
        "attribute": "# [doc = \" CHECK: bump 正規化なし\"]",
        "field_type": "AccountInfo < 'info >"
      },
      {
        "name": "admin",
        "attribute": null,
        "field_type": "AccountInfo < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "ScoreEntry",
    "node_type": "struct",
    "fields": [
      {
        "name": "admin",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "tag",
        "attribute": null,
        "field_type": "[u8 ; 8]"
      },
      {
        "name": "points",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "bias",
        "attribute": null,
        "field_type": "u32"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]