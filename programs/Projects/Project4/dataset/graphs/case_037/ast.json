[
  {
    "name": "create_order",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < CreateOrder >",
      "product_ids: Vec < u64 >",
      "quantities: Vec < u32 >"
    ],
    "attributes": [],
    "body": [
      "let mut total_qty = 0u32 ;",
      "let mut sum = 0u64 ;",
      "for (i , & pid) in product_ids . iter () . enumerate ()",
      "{",
      "let q = * quantities . get (i) . unwrap_or (& 0) ;",
      "total_qty += q ;",
      "sum += q as u64 * 100 ;",
      "}",
      "if total_qty > 10",
      "{",
      "sum = sum * 90 / 100 ;",
      "}",
      "let order = & mut ctx . accounts . order_account ;",
      "order . products = product_ids . clone () ;",
      "order . quantity = total_qty ;",
      "order . created_at = Clock :: get () ? . unix_timestamp ;",
      "let payment = & mut ctx . accounts . payment_account ;",
      "payment . payer = ctx . accounts . user . key () ;",
      "payment . amount = sum ;",
      "payment . paid = false ;",
      "let invoice = & mut ctx . accounts . invoice ;",
      "invoice . order = order . key () ;",
      "let start = Clock :: get () ? . unix_timestamp ;",
      "invoice . schedule = Vec :: new () ;",
      "for m in 1 ..= 3",
      "{",
      "invoice . schedule . push (start + (m as i64) * 30 * 86400) ;",
      "}",
      "Ok (())"
    ]
  },
  {
    "name": "CreateOrder",
    "node_type": "struct",
    "fields": [
      {
        "name": "order_account",
        "attribute": "# [account (init , payer = user , space = 8 + (8 * 10) + 4 + 8 + 8)]",
        "field_type": "Account < 'info , OrderData >"
      },
      {
        "name": "payment_account",
        "attribute": "# [account (init , payer = user , space = 8 + 32 + 8 + 1)]",
        "field_type": "Account < 'info , PaymentData >"
      },
      {
        "name": "invoice",
        "attribute": "# [account (init , payer = user , space = 8 + 32 + 4 + (8 * 3))]",
        "field_type": "Account < 'info , InvoiceData >"
      },
      {
        "name": "user",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "OrderData",
    "node_type": "struct",
    "fields": [
      {
        "name": "products",
        "attribute": null,
        "field_type": "Vec < u64 >"
      },
      {
        "name": "quantity",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "created_at",
        "attribute": null,
        "field_type": "i64"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "PaymentData",
    "node_type": "struct",
    "fields": [
      {
        "name": "payer",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "amount",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "paid",
        "attribute": null,
        "field_type": "bool"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "InvoiceData",
    "node_type": "struct",
    "fields": [
      {
        "name": "order",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "schedule",
        "attribute": null,
        "field_type": "Vec < i64 >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]