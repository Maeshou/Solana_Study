[
  {
    "name": "finalize_battle",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < FinalizeBattle >",
      "damage_to_attacker: u64",
      "damage_to_defender: u64"
    ],
    "attributes": [
      "# [doc = \" バトル結果を確定し、ポイントを計算するが、\"]",
      "# [doc = \" BattleResult.owner と呼び出しユーザーの照合チェックがない\"]"
    ],
    "body": [
      "let res = & mut ctx . accounts . battle_result ;",
      "res . attacker = ctx . accounts . attacker . key () ;",
      "res . defender = ctx . accounts . defender . key () ;",
      "res . attacker_hp = ctx . accounts . config . default_hp . checked_sub (damage_to_attacker) . unwrap () ;",
      "res . defender_hp = ctx . accounts . config . default_hp . checked_sub (damage_to_defender) . unwrap () ;",
      "res . attacker_points = ctx . accounts . config . base_points . checked_add (res . attacker_hp) . unwrap () ;",
      "res . defender_points = ctx . accounts . config . base_points . checked_add (res . defender_hp) . unwrap () ;",
      "res . resolved = true ;",
      "Ok (())"
    ]
  },
  {
    "name": "FinalizeBattle",
    "node_type": "struct",
    "fields": [
      {
        "name": "battle_result",
        "attribute": "# [account (mut)] # [doc = \" 本来は #[account(has_one = owner)] などで照合を行うべき\"]",
        "field_type": "Account < 'info , BattleResult >"
      },
      {
        "name": "attacker",
        "attribute": "# [doc = \" 攻撃側ユーザー（署名者）\"]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "defender",
        "attribute": "# [doc = \" 防御側ユーザー\"]",
        "field_type": "AccountInfo < 'info >"
      },
      {
        "name": "config",
        "attribute": "# [doc = \" 初期HP・ベースポイントなど設定を保持するアカウント\"]",
        "field_type": "Account < 'info , BattleConfig >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "BattleResult",
    "node_type": "struct",
    "fields": [
      {
        "name": "owner",
        "attribute": "# [doc = \" 本来はこの結果を所有するユーザーの Pubkey\"]",
        "field_type": "Pubkey"
      },
      {
        "name": "attacker",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "defender",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "attacker_hp",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "defender_hp",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "attacker_points",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "defender_points",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "resolved",
        "attribute": null,
        "field_type": "bool"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "BattleConfig",
    "node_type": "struct",
    "fields": [
      {
        "name": "default_hp",
        "attribute": "# [doc = \" 初期HP\"]",
        "field_type": "u64"
      },
      {
        "name": "base_points",
        "attribute": "# [doc = \" ベースポイント\"]",
        "field_type": "u64"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]