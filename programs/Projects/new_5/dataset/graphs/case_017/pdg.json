[
  {
    "name": "execute_sale",
    "inputs": [
      "ctx: Context < ExecuteSale >",
      "sale_price: u64",
      "commission_rate: u8",
      "tag_suffix: String"
    ],
    "nodes": [
      {
        "id": 0,
        "label": "Entry"
      },
      {
        "id": 1,
        "label": "let seller = & mut ctx . accounts . seller_acc ;"
      },
      {
        "id": 2,
        "label": "let buyer = & mut ctx . accounts . buyer_acc ;"
      },
      {
        "id": 3,
        "label": "let nft = & mut ctx . accounts . nft ;"
      },
      {
        "id": 4,
        "label": "let now = ctx . accounts . clock . unix_timestamp ;"
      },
      {
        "id": 5,
        "label": "seller . balance = seller . balance + sale_price ;"
      },
      {
        "id": 6,
        "label": "buyer . balance = buyer . balance - sale_price ;"
      },
      {
        "id": 7,
        "label": "let commission = sale_price * (commission_rate as u64) / 100 ;"
      },
      {
        "id": 8,
        "label": "seller . balance = seller . balance - commission ;"
      },
      {
        "id": 9,
        "label": "nft . owner = buyer . owner ;"
      },
      {
        "id": 10,
        "label": "seller . sale_count = seller . sale_count + 1 ;"
      },
      {
        "id": 11,
        "label": "buyer . purchase_count = buyer . purchase_count + 1 ;"
      },
      {
        "id": 12,
        "label": "seller . note = seller . note . clone () + \"|sold@\" + & now . to_string () ;"
      },
      {
        "id": 13,
        "label": "buyer . note = buyer . note . clone () + \"|bought@\" + & now . to_string () ;"
      },
      {
        "id": 14,
        "label": "nft . tag = (nft . tag . clone () + \"-\" + & tag_suffix) . to_uppercase () ;"
      },
      {
        "id": 15,
        "label": "msg ! (\"Sale executed: {} sold NFT to {} for {} lamports (commission={}, time={})\" , seller . owner , buyer . owner , sale_price , commission , now) ;"
      },
      {
        "id": 16,
        "label": "Ok (())"
      }
    ],
    "edges": [
      {
        "from": 1,
        "to": 1,
        "label": "def: seller"
      },
      {
        "from": 2,
        "to": 2,
        "label": "def: buyer"
      },
      {
        "from": 3,
        "to": 3,
        "label": "def: nft"
      },
      {
        "from": 4,
        "to": 4,
        "label": "def: now"
      },
      {
        "from": 1,
        "to": 5,
        "label": "data_dep: seller"
      },
      {
        "from": 1,
        "to": 5,
        "label": "data_dep: seller"
      },
      {
        "from": 2,
        "to": 6,
        "label": "data_dep: buyer"
      },
      {
        "from": 2,
        "to": 6,
        "label": "data_dep: buyer"
      },
      {
        "from": 7,
        "to": 7,
        "label": "def: commission"
      },
      {
        "from": 1,
        "to": 8,
        "label": "data_dep: seller"
      },
      {
        "from": 1,
        "to": 8,
        "label": "data_dep: seller"
      },
      {
        "from": 7,
        "to": 8,
        "label": "data_dep: commission"
      },
      {
        "from": 3,
        "to": 9,
        "label": "data_dep: nft"
      },
      {
        "from": 2,
        "to": 9,
        "label": "data_dep: buyer"
      },
      {
        "from": 1,
        "to": 10,
        "label": "data_dep: seller"
      },
      {
        "from": 1,
        "to": 10,
        "label": "data_dep: seller"
      },
      {
        "from": 2,
        "to": 11,
        "label": "data_dep: buyer"
      },
      {
        "from": 2,
        "to": 11,
        "label": "data_dep: buyer"
      },
      {
        "from": 1,
        "to": 12,
        "label": "data_dep: seller"
      },
      {
        "from": 1,
        "to": 12,
        "label": "data_dep: seller"
      },
      {
        "from": 4,
        "to": 12,
        "label": "data_dep: now"
      },
      {
        "from": 2,
        "to": 13,
        "label": "data_dep: buyer"
      },
      {
        "from": 2,
        "to": 13,
        "label": "data_dep: buyer"
      },
      {
        "from": 4,
        "to": 13,
        "label": "data_dep: now"
      },
      {
        "from": 3,
        "to": 14,
        "label": "data_dep: nft"
      },
      {
        "from": 3,
        "to": 14,
        "label": "data_dep: nft"
      }
    ]
  }
]