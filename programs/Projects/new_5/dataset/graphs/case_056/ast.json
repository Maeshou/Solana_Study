[
  {
    "name": "setup_battle_zone",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < SetupBattleZone >",
      "zone_id: u64",
      "name: String",
      "max_players: u32"
    ],
    "attributes": [],
    "body": [
      "let zone = & mut ctx . accounts . battle_zone ;",
      "zone . creator = ctx . accounts . creator . key () ;",
      "zone . zone_id = zone_id ;",
      "zone . name = name ;",
      "zone . active_battles = 0 ;",
      "zone . max_players = max_players ;",
      "zone . zone_status = ZoneStatus :: Active ;",
      "msg ! (\"Battle Zone '{}' initialized with a capacity of {}. Status is now Active.\" , zone . name , zone . max_players) ;",
      "Ok (())"
    ]
  },
  {
    "name": "enroll_combatant",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < EnrollCombatant >",
      "player_id: u32",
      "initial_power: u16"
    ],
    "attributes": [],
    "body": [
      "let combatant = & mut ctx . accounts . combatant_stats ;",
      "let zone = & mut ctx . accounts . battle_zone ;",
      "if zone . zone_status != ZoneStatus :: Active",
      "{",
      "return Err (error ! (BattleError :: ZoneNotActive)) ;",
      "}",
      "combatant . zone = zone . key () ;",
      "combatant . player_id = player_id ;",
      "combatant . player = ctx . accounts . player . key () ;",
      "combatant . health = initial_power . checked_mul (5) . unwrap_or (u16 :: MAX) ;",
      "combatant . stamina = initial_power . checked_div (2) . unwrap_or (0) ;",
      "combatant . last_action_timestamp = initial_power as i64 ;",
      "combatant . combat_status = CombatantStatus :: Ready ;",
      "zone . active_battles = zone . active_battles . saturating_add (1) ;",
      "msg ! (\"Combatant {} enrolled in battle zone. Health: {}, Stamina: {}.\" , combatant . player_id , combatant . health , combatant . stamina) ;",
      "Ok (())"
    ]
  },
  {
    "name": "execute_duel_round",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < ExecuteDuelRound >",
      "attacker_move: u8",
      "defender_move: u8"
    ],
    "attributes": [],
    "body": [
      "let attacker_stats = & mut ctx . accounts . attacker_stats ;",
      "let defender_stats = & mut ctx . accounts . defender_stats ;",
      "if attacker_stats . combat_status != CombatantStatus :: Ready || defender_stats . combat_status != CombatantStatus :: Ready",
      "{",
      "return Err (error ! (BattleError :: CombatantNotReady)) ;",
      "}",
      "let damage = (attacker_move as u16) . saturating_sub (defender_move as u16) ;",
      "defender_stats . health = defender_stats . health . checked_sub (damage) . unwrap_or (0) ;",
      "if defender_stats . health == 0",
      "{",
      "msg ! (\"Defender defeated!\") ;",
      "defender_stats . combat_status = CombatantStatus :: Defeated ;",
      "ctx . accounts . battle_zone . active_battles = ctx . accounts . battle_zone . active_battles . checked_sub (1) . unwrap_or (0) ;",
      "} else",
      "{",
      "msg ! (\"Defender takes {} damage.\" , damage) ;",
      "}",
      "Ok (())"
    ]
  },
  {
    "name": "SetupBattleZone",
    "node_type": "struct",
    "fields": [
      {
        "name": "battle_zone",
        "attribute": "# [account (init , payer = creator , space = 8 + 32 + 8 + 32 + 4 + 4 + 1)]",
        "field_type": "Account < 'info , BattleZone >"
      },
      {
        "name": "creator",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "EnrollCombatant",
    "node_type": "struct",
    "fields": [
      {
        "name": "battle_zone",
        "attribute": "# [account (mut , has_one = zone)]",
        "field_type": "Account < 'info , BattleZone >"
      },
      {
        "name": "combatant_stats",
        "attribute": "# [account (init , payer = player , space = 8 + 32 + 4 + 32 + 2 + 2 + 8 + 1)]",
        "field_type": "Account < 'info , CombatantStats >"
      },
      {
        "name": "player",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "ExecuteDuelRound",
    "node_type": "struct",
    "fields": [
      {
        "name": "battle_zone",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , BattleZone >"
      },
      {
        "name": "attacker_stats",
        "attribute": "# [account (mut , has_one = zone)]",
        "field_type": "Account < 'info , CombatantStats >"
      },
      {
        "name": "defender_stats",
        "attribute": "# [account (mut , has_one = zone)]",
        "field_type": "Account < 'info , CombatantStats >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "BattleZone",
    "node_type": "struct",
    "fields": [
      {
        "name": "creator",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "zone_id",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "name",
        "attribute": null,
        "field_type": "String"
      },
      {
        "name": "active_battles",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "max_players",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "zone_status",
        "attribute": null,
        "field_type": "ZoneStatus"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "CombatantStats",
    "node_type": "struct",
    "fields": [
      {
        "name": "zone",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "player_id",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "player",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "health",
        "attribute": null,
        "field_type": "u16"
      },
      {
        "name": "stamina",
        "attribute": null,
        "field_type": "u16"
      },
      {
        "name": "last_action_timestamp",
        "attribute": null,
        "field_type": "i64"
      },
      {
        "name": "combat_status",
        "attribute": null,
        "field_type": "CombatantStatus"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]