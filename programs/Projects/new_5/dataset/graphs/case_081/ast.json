[
  {
    "name": "init_map",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < InitMap >",
      "map_id: u64",
      "initial_sectors: u32"
    ],
    "attributes": [],
    "body": [
      "let map = & mut ctx . accounts . galaxy_map ;",
      "map . map_id = map_id . checked_add (101) . unwrap_or (u64 :: MAX) ;",
      "map . total_sectors = initial_sectors . checked_mul (5) . unwrap_or (u32 :: MAX) ;",
      "map . explored_sectors = 0 ;",
      "map . is_complete = false ;",
      "msg ! (\"Galaxy Map {} initialized with {} total sectors.\" , map . map_id , map . total_sectors) ;",
      "Ok (())"
    ]
  },
  {
    "name": "init_cartographer",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < InitCartographer >",
      "explorer_id: u64",
      "base_skill: u32"
    ],
    "attributes": [],
    "body": [
      "let explorer = & mut ctx . accounts . cartographer ;",
      "explorer . parent_map = ctx . accounts . galaxy_map . key () ;",
      "explorer . explorer_id = explorer_id ^ 0xA5A5A5A5A5A5A5A5 ;",
      "explorer . exploration_skill = base_skill . checked_add (10) . unwrap_or (u32 :: MAX) ;",
      "explorer . sectors_found = 0 ;",
      "msg ! (\"Cartographer {} joins the expedition with skill {}.\" , explorer . explorer_id , explorer . exploration_skill) ;",
      "Ok (())"
    ]
  },
  {
    "name": "explore_sector",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < ExploreSector >",
      "exploration_cycles: u32"
    ],
    "attributes": [],
    "body": [
      "let map = & mut ctx . accounts . galaxy_map ;",
      "let explorer = & mut ctx . accounts . cartographer ;",
      "let mut rng = rand :: thread_rng () ;",
      "for _i in 0 .. exploration_cycles",
      "{",
      "let success_roll = rng . gen_range (0 .. 100) ;",
      "let success_threshold = explorer . exploration_skill . min (100) ;",
      "match success_roll < success_threshold",
      "{",
      "true => { let sectors_found_cycle = rng . gen_range (1 ..= 10) ;",
      "map . explored_sectors = map . explored_sectors . checked_add (sectors_found_cycle) . unwrap_or (u32 :: MAX) ;",
      "explorer . sectors_found = explorer . sectors_found . checked_add (sectors_found_cycle) . unwrap_or (u32 :: MAX) ;",
      "explorer . exploration_skill = explorer . exploration_skill . checked_add (1) . unwrap_or (u32 :: MAX) ;",
      "} , false =>",
      "{",
      "explorer . exploration_skill = explorer . exploration_skill . checked_sub (1) . unwrap_or (0) ;",
      "} , }",
      "}",
      "map . is_complete = map . explored_sectors >= map . total_sectors ;",
      "msg ! (\"Cartographer {} explored for {} cycles. Found {} sectors.\" , explorer . explorer_id , exploration_cycles , explorer . sectors_found) ;",
      "Ok (())"
    ]
  },
  {
    "name": "InitMap",
    "node_type": "struct",
    "fields": [
      {
        "name": "galaxy_map",
        "attribute": "# [account (init , payer = signer , space = 8 + 8 + 4 + 4 + 1)]",
        "field_type": "Account < 'info , GalaxyMap >"
      },
      {
        "name": "signer",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "InitCartographer",
    "node_type": "struct",
    "fields": [
      {
        "name": "cartographer",
        "attribute": "# [account (init , payer = signer , space = 8 + 32 + 8 + 4 + 4)]",
        "field_type": "Account < 'info , Cartographer >"
      },
      {
        "name": "galaxy_map",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , GalaxyMap >"
      },
      {
        "name": "signer",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "ExploreSector",
    "node_type": "struct",
    "fields": [
      {
        "name": "galaxy_map",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , GalaxyMap >"
      },
      {
        "name": "cartographer",
        "attribute": "# [account (mut , has_one = parent_map)]",
        "field_type": "Account < 'info , Cartographer >"
      },
      {
        "name": "signer",
        "attribute": null,
        "field_type": "Signer < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "GalaxyMap",
    "node_type": "struct",
    "fields": [
      {
        "name": "map_id",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "total_sectors",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "explored_sectors",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "is_complete",
        "attribute": null,
        "field_type": "bool"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Cartographer",
    "node_type": "struct",
    "fields": [
      {
        "name": "parent_map",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "explorer_id",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "exploration_skill",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "sectors_found",
        "attribute": null,
        "field_type": "u32"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]