[
  {
    "name": "init_guild",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < InitGuild >",
      "tag: u8"
    ],
    "attributes": [],
    "body": [
      "let g = & mut ctx . accounts . guild ;",
      "g . admin = ctx . accounts . admin . key () ;",
      "g . tag = tag ;",
      "g . member_count = 0 ;",
      "g . reputation = 1000 ;",
      "Ok (())"
    ]
  },
  {
    "name": "init_member",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < InitMember >",
      "seat: u16"
    ],
    "attributes": [],
    "body": [
      "let m = & mut ctx . accounts . member ;",
      "m . parent = ctx . accounts . guild . key () ;",
      "m . player = ctx . accounts . player . key () ;",
      "m . seat = seat ;",
      "m . status = Vacant ;",
      "m . points = 0 ;",
      "Ok (())"
    ]
  },
  {
    "name": "update_seats",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < UpdateSeats >",
      "add_points: u32"
    ],
    "attributes": [],
    "body": [
      "let g = & mut ctx . accounts . guild ;",
      "let a = & mut ctx . accounts . member_a ;",
      "let b = & mut ctx . accounts . member_b ;",
      "let mut accum : u64 = 0 ;",
      "let mut x = (g . reputation as u64) . max (1) ;",
      "let mut i = 0 ;",
      "while i < 6",
      "{",
      "let nx = (x + (g . reputation as u64) / x) / 2 ;",
      "let diff = if nx > x",
      "{",
      "nx - x } else { x - nx } ;",
      "x = nx ;",
      "accum = accum . checked_add (diff) . unwrap_or (u64 :: MAX) ;",
      "i += 1 ;",
      "}",
      "if (a . seat % 2) == 0",
      "{",
      "a . points = a . points . checked_add (add_points / 2) . unwrap_or (u32 :: MAX) ;",
      "a . status = Occupied ;",
      "g . member_count = g . member_count . saturating_add (1) ;",
      "g . reputation = ((g . reputation as u64 + accum / 4) as u32) . min (50_000) ;",
      "msg ! (\"Seat A occupied;",
      "acc=",
      "{",
      "}, rep={}\" , accum , g . reputation) ;",
      "} else",
      "{",
      "a . points = a . points . saturating_sub (add_points / 3) ;",
      "a . status = Suspended ;",
      "g . member_count = g . member_count . saturating_sub (1) ;",
      "g . reputation = g . reputation / 2 + ((accum % 97) as u32) ;",
      "msg ! (\"Seat A suspended;",
      "acc=",
      "{",
      "}, rep={}\" , accum , g . reputation) ;",
      "}",
      "for _ in 0 .. 3",
      "{",
      "let mask = 0b10101u32 ;",
      "if b . points & mask == 0",
      "{",
      "b . points = b . points . saturating_add (add_points) ;",
      "b . status = Occupied ;",
      "g . reputation = g . reputation . saturating_add ((b . seat as u32) & 255) ;",
      "msg ! (\"B boosted;",
      "pts=",
      "{",
      "}, rep={}\" , b . points , g . reputation) ;",
      "} else",
      "{",
      "b . points = b . points . saturating_sub (add_points / 2) ;",
      "b . status = Suspended ;",
      "g . reputation = g . reputation . saturating_sub (((b . seat as u32) & 63) + 1) ;",
      "msg ! (\"B reduced;",
      "pts=",
      "{",
      "}, rep={}\" , b . points , g . reputation) ;",
      "}",
      "}",
      "Ok (())"
    ]
  },
  {
    "name": "InitGuild",
    "node_type": "struct",
    "fields": [
      {
        "name": "guild",
        "attribute": "# [account (init , payer = admin , space = 8 + 32 + 1 + 4 + 4)]",
        "field_type": "Account < 'info , Guild >"
      },
      {
        "name": "admin",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "InitMember",
    "node_type": "struct",
    "fields": [
      {
        "name": "guild",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , Guild >"
      },
      {
        "name": "member",
        "attribute": "# [account (init , payer = player , space = 8 + 32 + 32 + 2 + 1 + 4)]",
        "field_type": "Account < 'info , Member >"
      },
      {
        "name": "player",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "UpdateSeats",
    "node_type": "struct",
    "fields": [
      {
        "name": "guild",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , Guild >"
      },
      {
        "name": "member_a",
        "attribute": "# [account (mut , has_one = parent)]",
        "field_type": "Account < 'info , Member >"
      },
      {
        "name": "member_b",
        "attribute": "# [account (mut , has_one = parent)]",
        "field_type": "Account < 'info , Member >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Guild",
    "node_type": "struct",
    "fields": [
      {
        "name": "admin",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "tag",
        "attribute": null,
        "field_type": "u8"
      },
      {
        "name": "member_count",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "reputation",
        "attribute": null,
        "field_type": "u32"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Member",
    "node_type": "struct",
    "fields": [
      {
        "name": "parent",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "player",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "seat",
        "attribute": null,
        "field_type": "u16"
      },
      {
        "name": "status",
        "attribute": null,
        "field_type": "SeatStatus"
      },
      {
        "name": "points",
        "attribute": null,
        "field_type": "u32"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]