[
  {
    "name": "enchant_weapon",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < EnchantWeapon >"
    ],
    "attributes": [
      "# [doc = \" 武器のエンチャントを試みる\"]"
    ],
    "body": [
      "let weapon = & mut ctx . accounts . weapon_to_enchant ;",
      "let scroll = & mut ctx . accounts . enchantment_scroll ;",
      "let clock = Clock :: get () ? ;",
      "let success_seed = (clock . slot % 100) as u32 ;",
      "let success_chance = 75 - (weapon . enchant_level * 5) ;",
      "let is_success = success_seed < success_chance ;",
      "let success_increment = is_success as u32 ;",
      "weapon . enchant_level = weapon . enchant_level . saturating_add (success_increment) ;",
      "weapon . base_attack = weapon . base_attack . saturating_add (success_increment * 5) ;",
      "scroll . quantity = scroll . quantity . saturating_sub (1) ;",
      "msg ! (\"Enchantment finished. Weapon level is now: {}\" , weapon . enchant_level) ;",
      "Ok (())"
    ]
  },
  {
    "name": "EnchantWeapon",
    "node_type": "struct",
    "fields": [
      {
        "name": "weapon_to_enchant",
        "attribute": "# [account (mut , has_one = owner)]",
        "field_type": "Account < 'info , Weapon >"
      },
      {
        "name": "enchantment_scroll",
        "attribute": "# [account (mut , constraint = enchantment_scroll . quantity > 0)]",
        "field_type": "Account < 'info , Item >"
      },
      {
        "name": "owner",
        "attribute": null,
        "field_type": "Signer < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Weapon",
    "node_type": "struct",
    "fields": [
      {
        "name": "owner",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "enchant_level",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "base_attack",
        "attribute": null,
        "field_type": "u32"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Item",
    "node_type": "struct",
    "fields": [
      {
        "name": "owner",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "quantity",
        "attribute": null,
        "field_type": "u32"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]