[
  {
    "name": "initiate_guild_war",
    "inputs": [
      "ctx: Context < InitiateGuildWar >"
    ],
    "nodes": [
      {
        "id": 0,
        "label": "Entry"
      },
      {
        "id": 1,
        "label": "let attacking_guild = & mut ctx . accounts . attacking_guild ;"
      },
      {
        "id": 2,
        "label": "let defending_guild = & mut ctx . accounts . defending_guild ;"
      },
      {
        "id": 3,
        "label": "let battle_arena = & mut ctx . accounts . battle_arena ;"
      },
      {
        "id": 4,
        "label": "require ! (attacking_guild . member_count >= 10 , BattleError :: InsufficientMembers) ;"
      },
      {
        "id": 5,
        "label": "require ! (defending_guild . member_count >= 10 , BattleError :: InsufficientMembers) ;"
      },
      {
        "id": 6,
        "label": "require ! (attacking_guild . guild_level >= 5 , BattleError :: GuildLevelTooLow) ;"
      },
      {
        "id": 7,
        "label": "let current_time = Clock :: get () ? . unix_timestamp ;"
      },
      {
        "id": 8,
        "label": "let last_battle_time = attacking_guild . last_battle_time ;"
      },
      {
        "id": 9,
        "label": "let cooldown_period = 86400 ;"
      },
      {
        "id": 10,
        "label": "require ! (current_time >= last_battle_time + cooldown_period , BattleError :: CooldownActive) ;"
      },
      {
        "id": 11,
        "label": "battle_arena . battle_id = battle_arena . total_battles + 1 ;"
      },
      {
        "id": 12,
        "label": "battle_arena . attacking_guild_id = attacking_guild . guild_id ;"
      },
      {
        "id": 13,
        "label": "battle_arena . defending_guild_id = defending_guild . guild_id ;"
      },
      {
        "id": 14,
        "label": "battle_arena . battle_status = BattleStatus :: Preparation ;"
      },
      {
        "id": 15,
        "label": "battle_arena . preparation_end_time = current_time + 3600 ;"
      },
      {
        "id": 16,
        "label": "let max_participants = std :: cmp :: min (attacking_guild . member_count , defending_guild . member_count) ;"
      },
      {
        "id": 17,
        "label": "let actual_participants = std :: cmp :: min (max_participants , 20) ;"
      },
      {
        "id": 18,
        "label": "let mut attacking_power = 0u64 ;"
      },
      {
        "id": 19,
        "label": "let mut defending_power = 0u64 ;"
      },
      {
        "id": 20,
        "label": "for member_index in 0 .. actual_participants { let member_level = attacking_guild . member_levels . get (member_index) . unwrap_or (& 1) ; let equipment_bonus = attacking_guild . equipment_scores . get (member_index) . unwrap_or (& 0) ; let member_power = member_level . checked_mul (100) . unwrap () . checked_add (* equipment_bonus) . unwrap () ; attacking_power = attacking_power . checked_add (member_power) . unwrap () ; }"
      },
      {
        "id": 21,
        "label": "let member_level = attacking_guild . member_levels . get (member_index) . unwrap_or (& 1) ;"
      },
      {
        "id": 22,
        "label": "let equipment_bonus = attacking_guild . equipment_scores . get (member_index) . unwrap_or (& 0) ;"
      },
      {
        "id": 23,
        "label": "let member_power = member_level . checked_mul (100) . unwrap () . checked_add (* equipment_bonus) . unwrap () ;"
      },
      {
        "id": 24,
        "label": "attacking_power = attacking_power . checked_add (member_power) . unwrap () ;"
      },
      {
        "id": 25,
        "label": "while defending_power < attacking_power { for member_index in 0 .. actual_participants { let member_level = defending_guild . member_levels . get (member_index) . unwrap_or (& 1) ; let defense_bonus = defending_guild . fortress_level * 50 ; let member_power = member_level . checked_mul (100) . unwrap () . checked_add (defense_bonus) . unwrap () ; defending_power = defending_power . checked_add (member_power) . unwrap () ; defending_power = defending_power . checked_mul (110) . unwrap () / 100 ; break ; } break ; }"
      },
      {
        "id": 26,
        "label": "for member_index in 0 .. actual_participants { let member_level = defending_guild . member_levels . get (member_index) . unwrap_or (& 1) ; let defense_bonus = defending_guild . fortress_level * 50 ; let member_power = member_level . checked_mul (100) . unwrap () . checked_add (defense_bonus) . unwrap () ; defending_power = defending_power . checked_add (member_power) . unwrap () ; defending_power = defending_power . checked_mul (110) . unwrap () / 100 ; break ; }"
      },
      {
        "id": 27,
        "label": "let member_level = defending_guild . member_levels . get (member_index) . unwrap_or (& 1) ;"
      },
      {
        "id": 28,
        "label": "let defense_bonus = defending_guild . fortress_level * 50 ;"
      },
      {
        "id": 29,
        "label": "let member_power = member_level . checked_mul (100) . unwrap () . checked_add (defense_bonus) . unwrap () ;"
      },
      {
        "id": 30,
        "label": "defending_power = defending_power . checked_add (member_power) . unwrap () ;"
      },
      {
        "id": 31,
        "label": "defending_power = defending_power . checked_mul (110) . unwrap () / 100 ;"
      },
      {
        "id": 32,
        "label": "break ;"
      },
      {
        "id": 33,
        "label": "break ;"
      },
      {
        "id": 34,
        "label": "battle_arena . attacking_power = attacking_power ;"
      },
      {
        "id": 35,
        "label": "battle_arena . defending_power = defending_power ;"
      },
      {
        "id": 36,
        "label": "battle_arena . total_battles = battle_arena . total_battles . checked_add (1) . unwrap () ;"
      },
      {
        "id": 37,
        "label": "attacking_guild . last_battle_time = current_time ;"
      },
      {
        "id": 38,
        "label": "attacking_guild . total_wars_initiated = attacking_guild . total_wars_initiated . checked_add (1) . unwrap () ;"
      },
      {
        "id": 39,
        "label": "defending_guild . total_wars_defended = defending_guild . total_wars_defended . checked_add (1) . unwrap () ;"
      },
      {
        "id": 40,
        "label": "emit ! (GuildWarInitiated { attacking_guild : attacking_guild . guild_id , defending_guild : defending_guild . guild_id , battle_id : battle_arena . battle_id , participants : actual_participants , }) ;"
      },
      {
        "id": 41,
        "label": "Ok (())"
      }
    ],
    "edges": [
      {
        "from": 1,
        "to": 1,
        "label": "def: attacking_guild"
      },
      {
        "from": 2,
        "to": 2,
        "label": "def: defending_guild"
      },
      {
        "from": 3,
        "to": 3,
        "label": "def: battle_arena"
      },
      {
        "from": 7,
        "to": 7,
        "label": "def: current_time"
      },
      {
        "from": 8,
        "to": 8,
        "label": "def: last_battle_time"
      },
      {
        "from": 1,
        "to": 8,
        "label": "data_dep: attacking_guild"
      },
      {
        "from": 9,
        "to": 9,
        "label": "def: cooldown_period"
      },
      {
        "from": 3,
        "to": 11,
        "label": "data_dep: battle_arena"
      },
      {
        "from": 3,
        "to": 11,
        "label": "data_dep: battle_arena"
      },
      {
        "from": 3,
        "to": 12,
        "label": "data_dep: battle_arena"
      },
      {
        "from": 1,
        "to": 12,
        "label": "data_dep: attacking_guild"
      },
      {
        "from": 3,
        "to": 13,
        "label": "data_dep: battle_arena"
      },
      {
        "from": 2,
        "to": 13,
        "label": "data_dep: defending_guild"
      },
      {
        "from": 3,
        "to": 14,
        "label": "data_dep: battle_arena"
      },
      {
        "from": 3,
        "to": 15,
        "label": "data_dep: battle_arena"
      },
      {
        "from": 7,
        "to": 15,
        "label": "data_dep: current_time"
      },
      {
        "from": 16,
        "to": 16,
        "label": "def: max_participants"
      },
      {
        "from": 1,
        "to": 16,
        "label": "data_dep: attacking_guild"
      },
      {
        "from": 2,
        "to": 16,
        "label": "data_dep: defending_guild"
      },
      {
        "from": 17,
        "to": 17,
        "label": "def: actual_participants"
      },
      {
        "from": 16,
        "to": 17,
        "label": "data_dep: max_participants"
      },
      {
        "from": 18,
        "to": 18,
        "label": "def: attacking_power"
      },
      {
        "from": 19,
        "to": 19,
        "label": "def: defending_power"
      },
      {
        "from": 17,
        "to": 20,
        "label": "data_dep: actual_participants"
      },
      {
        "from": 1,
        "to": 20,
        "label": "data_dep: attacking_guild"
      },
      {
        "from": 1,
        "to": 20,
        "label": "data_dep: attacking_guild"
      },
      {
        "from": 18,
        "to": 20,
        "label": "data_dep: attacking_power"
      },
      {
        "from": 18,
        "to": 20,
        "label": "data_dep: attacking_power"
      },
      {
        "from": 21,
        "to": 21,
        "label": "def: member_level"
      },
      {
        "from": 1,
        "to": 21,
        "label": "data_dep: attacking_guild"
      },
      {
        "from": 22,
        "to": 22,
        "label": "def: equipment_bonus"
      },
      {
        "from": 1,
        "to": 22,
        "label": "data_dep: attacking_guild"
      },
      {
        "from": 23,
        "to": 23,
        "label": "def: member_power"
      },
      {
        "from": 21,
        "to": 23,
        "label": "data_dep: member_level"
      },
      {
        "from": 22,
        "to": 23,
        "label": "data_dep: equipment_bonus"
      },
      {
        "from": 18,
        "to": 24,
        "label": "data_dep: attacking_power"
      },
      {
        "from": 18,
        "to": 24,
        "label": "data_dep: attacking_power"
      },
      {
        "from": 23,
        "to": 24,
        "label": "data_dep: member_power"
      },
      {
        "from": 19,
        "to": 25,
        "label": "data_dep: defending_power"
      },
      {
        "from": 18,
        "to": 25,
        "label": "data_dep: attacking_power"
      },
      {
        "from": 17,
        "to": 25,
        "label": "data_dep: actual_participants"
      },
      {
        "from": 2,
        "to": 25,
        "label": "data_dep: defending_guild"
      },
      {
        "from": 2,
        "to": 25,
        "label": "data_dep: defending_guild"
      },
      {
        "from": 21,
        "to": 25,
        "label": "data_dep: member_level"
      },
      {
        "from": 19,
        "to": 25,
        "label": "data_dep: defending_power"
      },
      {
        "from": 19,
        "to": 25,
        "label": "data_dep: defending_power"
      },
      {
        "from": 23,
        "to": 25,
        "label": "data_dep: member_power"
      },
      {
        "from": 19,
        "to": 25,
        "label": "data_dep: defending_power"
      },
      {
        "from": 19,
        "to": 25,
        "label": "data_dep: defending_power"
      },
      {
        "from": 17,
        "to": 26,
        "label": "data_dep: actual_participants"
      },
      {
        "from": 2,
        "to": 26,
        "label": "data_dep: defending_guild"
      },
      {
        "from": 2,
        "to": 26,
        "label": "data_dep: defending_guild"
      },
      {
        "from": 21,
        "to": 26,
        "label": "data_dep: member_level"
      },
      {
        "from": 19,
        "to": 26,
        "label": "data_dep: defending_power"
      },
      {
        "from": 19,
        "to": 26,
        "label": "data_dep: defending_power"
      },
      {
        "from": 23,
        "to": 26,
        "label": "data_dep: member_power"
      },
      {
        "from": 19,
        "to": 26,
        "label": "data_dep: defending_power"
      },
      {
        "from": 19,
        "to": 26,
        "label": "data_dep: defending_power"
      },
      {
        "from": 27,
        "to": 27,
        "label": "def: member_level"
      },
      {
        "from": 2,
        "to": 27,
        "label": "data_dep: defending_guild"
      },
      {
        "from": 28,
        "to": 28,
        "label": "def: defense_bonus"
      },
      {
        "from": 2,
        "to": 28,
        "label": "data_dep: defending_guild"
      },
      {
        "from": 29,
        "to": 29,
        "label": "def: member_power"
      },
      {
        "from": 27,
        "to": 29,
        "label": "data_dep: member_level"
      },
      {
        "from": 28,
        "to": 29,
        "label": "data_dep: defense_bonus"
      },
      {
        "from": 19,
        "to": 30,
        "label": "data_dep: defending_power"
      },
      {
        "from": 19,
        "to": 30,
        "label": "data_dep: defending_power"
      },
      {
        "from": 29,
        "to": 30,
        "label": "data_dep: member_power"
      },
      {
        "from": 19,
        "to": 31,
        "label": "data_dep: defending_power"
      },
      {
        "from": 19,
        "to": 31,
        "label": "data_dep: defending_power"
      },
      {
        "from": 3,
        "to": 34,
        "label": "data_dep: battle_arena"
      },
      {
        "from": 18,
        "to": 34,
        "label": "data_dep: attacking_power"
      },
      {
        "from": 3,
        "to": 35,
        "label": "data_dep: battle_arena"
      },
      {
        "from": 19,
        "to": 35,
        "label": "data_dep: defending_power"
      },
      {
        "from": 3,
        "to": 36,
        "label": "data_dep: battle_arena"
      },
      {
        "from": 3,
        "to": 36,
        "label": "data_dep: battle_arena"
      },
      {
        "from": 1,
        "to": 37,
        "label": "data_dep: attacking_guild"
      },
      {
        "from": 7,
        "to": 37,
        "label": "data_dep: current_time"
      },
      {
        "from": 1,
        "to": 38,
        "label": "data_dep: attacking_guild"
      },
      {
        "from": 1,
        "to": 38,
        "label": "data_dep: attacking_guild"
      },
      {
        "from": 2,
        "to": 39,
        "label": "data_dep: defending_guild"
      },
      {
        "from": 2,
        "to": 39,
        "label": "data_dep: defending_guild"
      }
    ]
  }
]