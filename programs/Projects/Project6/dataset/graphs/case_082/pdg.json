[
  {
    "name": "initiate_combat_challenge",
    "inputs": [
      "ctx: Context < InitiateCombat >",
      "challenger_warrior_id: u32",
      "defender_warrior_id: u32"
    ],
    "nodes": [
      {
        "id": 0,
        "label": "Entry"
      },
      {
        "id": 1,
        "label": "let challenger_account = & mut ctx . accounts . challenger_account ;"
      },
      {
        "id": 2,
        "label": "let defender_account = & mut ctx . accounts . defender_account ;"
      },
      {
        "id": 3,
        "label": "let battle_session = & mut ctx . accounts . battle_session ;"
      },
      {
        "id": 4,
        "label": "require ! (challenger_account . warrior_tokens . contains (& challenger_warrior_id) , BattleError :: WarriorNotOwned) ;"
      },
      {
        "id": 5,
        "label": "require ! (defender_account . warrior_tokens . contains (& defender_warrior_id) , BattleError :: DefenderWarriorInvalid) ;"
      },
      {
        "id": 6,
        "label": "let challenger_power = calculate_warrior_combat_rating (challenger_warrior_id) ;"
      },
      {
        "id": 7,
        "label": "let defender_power = calculate_warrior_combat_rating (defender_warrior_id) ;"
      },
      {
        "id": 8,
        "label": "battle_session . challenger_address = ctx . accounts . challenger . key () ;"
      },
      {
        "id": 9,
        "label": "battle_session . defender_address = ctx . accounts . defender . key () ;"
      },
      {
        "id": 10,
        "label": "battle_session . challenger_warrior = challenger_warrior_id ;"
      },
      {
        "id": 11,
        "label": "battle_session . defender_warrior = defender_warrior_id ;"
      },
      {
        "id": 12,
        "label": "battle_session . battle_status = BattleStatus :: InProgress ;"
      },
      {
        "id": 13,
        "label": "battle_session . combat_rounds_remaining = 10 ;"
      },
      {
        "id": 14,
        "label": "battle_session . challenger_health = 1000 ;"
      },
      {
        "id": 15,
        "label": "battle_session . defender_health = 1000 ;"
      },
      {
        "id": 16,
        "label": "let initial_damage = challenger_power / 20 ;"
      },
      {
        "id": 17,
        "label": "battle_session . defender_health = battle_session . defender_health . saturating_sub (initial_damage) ;"
      },
      {
        "id": 18,
        "label": "emit ! (CombatInitiated { battle_id : battle_session . key () , challenger : ctx . accounts . challenger . key () , defender : ctx . accounts . defender . key () , }) ;"
      },
      {
        "id": 19,
        "label": "Ok (())"
      }
    ],
    "edges": [
      {
        "from": 1,
        "to": 1,
        "label": "def: challenger_account"
      },
      {
        "from": 2,
        "to": 2,
        "label": "def: defender_account"
      },
      {
        "from": 3,
        "to": 3,
        "label": "def: battle_session"
      },
      {
        "from": 6,
        "to": 6,
        "label": "def: challenger_power"
      },
      {
        "from": 7,
        "to": 7,
        "label": "def: defender_power"
      },
      {
        "from": 3,
        "to": 8,
        "label": "data_dep: battle_session"
      },
      {
        "from": 3,
        "to": 9,
        "label": "data_dep: battle_session"
      },
      {
        "from": 3,
        "to": 10,
        "label": "data_dep: battle_session"
      },
      {
        "from": 3,
        "to": 11,
        "label": "data_dep: battle_session"
      },
      {
        "from": 3,
        "to": 12,
        "label": "data_dep: battle_session"
      },
      {
        "from": 3,
        "to": 13,
        "label": "data_dep: battle_session"
      },
      {
        "from": 3,
        "to": 14,
        "label": "data_dep: battle_session"
      },
      {
        "from": 3,
        "to": 15,
        "label": "data_dep: battle_session"
      },
      {
        "from": 16,
        "to": 16,
        "label": "def: initial_damage"
      },
      {
        "from": 6,
        "to": 16,
        "label": "data_dep: challenger_power"
      },
      {
        "from": 3,
        "to": 17,
        "label": "data_dep: battle_session"
      },
      {
        "from": 3,
        "to": 17,
        "label": "data_dep: battle_session"
      },
      {
        "from": 16,
        "to": 17,
        "label": "data_dep: initial_damage"
      }
    ]
  },
  {
    "name": "execute_combat_round",
    "inputs": [
      "ctx: Context < ExecuteCombatRound >",
      "attack_strategy: AttackStrategy"
    ],
    "nodes": [
      {
        "id": 20,
        "label": "Entry"
      },
      {
        "id": 21,
        "label": "let battle_session = & mut ctx . accounts . battle_session ;"
      },
      {
        "id": 22,
        "label": "let attacker_account = & ctx . accounts . attacker_account ;"
      },
      {
        "id": 23,
        "label": "require ! (battle_session . battle_status == BattleStatus :: InProgress , BattleError :: BattleNotActive) ;"
      },
      {
        "id": 24,
        "label": "require ! (battle_session . combat_rounds_remaining > 0 , BattleError :: BattleAlreadyFinished) ;"
      },
      {
        "id": 25,
        "label": "let attacker_warrior_id = if ctx . accounts . attacker . key () == battle_session . challenger_address { battle_session . challenger_warrior } else { battle_session . defender_warrior } ;"
      },
      {
        "id": 26,
        "label": "battle_session . challenger_warrior"
      },
      {
        "id": 27,
        "label": "battle_session . defender_warrior"
      },
      {
        "id": 28,
        "label": "let base_attack_damage = calculate_attack_damage (attacker_warrior_id , attack_strategy) ;"
      },
      {
        "id": 29,
        "label": "let critical_hit_chance = attacker_warrior_id % 20 ;"
      },
      {
        "id": 30,
        "label": "let final_damage = if critical_hit_chance > 15 { base_attack_damage * 2 } else { base_attack_damage } ;"
      },
      {
        "id": 31,
        "label": "base_attack_damage * 2"
      },
      {
        "id": 32,
        "label": "base_attack_damage"
      },
      {
        "id": 33,
        "label": "if ctx . accounts . attacker . key () == battle_session . challenger_address { battle_session . defender_health = battle_session . defender_health . saturating_sub (final_damage) ; } else { battle_session . challenger_health = battle_session . challenger_health . saturating_sub (final_damage) ; }"
      },
      {
        "id": 34,
        "label": "battle_session . defender_health = battle_session . defender_health . saturating_sub (final_damage) ;"
      },
      {
        "id": 35,
        "label": "battle_session . challenger_health = battle_session . challenger_health . saturating_sub (final_damage) ;"
      },
      {
        "id": 36,
        "label": "battle_session . combat_rounds_remaining -= 1 ;"
      },
      {
        "id": 37,
        "label": "let victory_condition = battle_session . challenger_health > 0 && battle_session . defender_health > 0 ;"
      },
      {
        "id": 38,
        "label": "if ! victory_condition || battle_session . combat_rounds_remaining <= 0 { battle_session . battle_status = BattleStatus :: Completed ; let winner_address = if battle_session . challenger_health > battle_session . defender_health { battle_session . challenger_address } else { battle_session . defender_address } ; emit ! (BattleCompleted { battle_id : battle_session . key () , winner : winner_address , final_damage : final_damage , }) ; }"
      },
      {
        "id": 39,
        "label": "battle_session . battle_status = BattleStatus :: Completed ;"
      },
      {
        "id": 40,
        "label": "let winner_address = if battle_session . challenger_health > battle_session . defender_health { battle_session . challenger_address } else { battle_session . defender_address } ;"
      },
      {
        "id": 41,
        "label": "battle_session . challenger_address"
      },
      {
        "id": 42,
        "label": "battle_session . defender_address"
      },
      {
        "id": 43,
        "label": "emit ! (BattleCompleted { battle_id : battle_session . key () , winner : winner_address , final_damage : final_damage , }) ;"
      },
      {
        "id": 44,
        "label": "Ok (())"
      }
    ],
    "edges": [
      {
        "from": 21,
        "to": 21,
        "label": "def: battle_session"
      },
      {
        "from": 22,
        "to": 22,
        "label": "def: attacker_account"
      },
      {
        "from": 25,
        "to": 25,
        "label": "def: attacker_warrior_id"
      },
      {
        "from": 21,
        "to": 25,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 25,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 25,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 26,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 27,
        "label": "data_dep: battle_session"
      },
      {
        "from": 28,
        "to": 28,
        "label": "def: base_attack_damage"
      },
      {
        "from": 25,
        "to": 28,
        "label": "data_dep: attacker_warrior_id"
      },
      {
        "from": 29,
        "to": 29,
        "label": "def: critical_hit_chance"
      },
      {
        "from": 25,
        "to": 29,
        "label": "data_dep: attacker_warrior_id"
      },
      {
        "from": 30,
        "to": 30,
        "label": "def: final_damage"
      },
      {
        "from": 29,
        "to": 30,
        "label": "data_dep: critical_hit_chance"
      },
      {
        "from": 28,
        "to": 30,
        "label": "data_dep: base_attack_damage"
      },
      {
        "from": 28,
        "to": 30,
        "label": "data_dep: base_attack_damage"
      },
      {
        "from": 28,
        "to": 31,
        "label": "data_dep: base_attack_damage"
      },
      {
        "from": 28,
        "to": 32,
        "label": "data_dep: base_attack_damage"
      },
      {
        "from": 21,
        "to": 33,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 33,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 33,
        "label": "data_dep: battle_session"
      },
      {
        "from": 30,
        "to": 33,
        "label": "data_dep: final_damage"
      },
      {
        "from": 21,
        "to": 33,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 33,
        "label": "data_dep: battle_session"
      },
      {
        "from": 30,
        "to": 33,
        "label": "data_dep: final_damage"
      },
      {
        "from": 21,
        "to": 34,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 34,
        "label": "data_dep: battle_session"
      },
      {
        "from": 30,
        "to": 34,
        "label": "data_dep: final_damage"
      },
      {
        "from": 21,
        "to": 35,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 35,
        "label": "data_dep: battle_session"
      },
      {
        "from": 30,
        "to": 35,
        "label": "data_dep: final_damage"
      },
      {
        "from": 21,
        "to": 36,
        "label": "data_dep: battle_session"
      },
      {
        "from": 37,
        "to": 37,
        "label": "def: victory_condition"
      },
      {
        "from": 21,
        "to": 37,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 37,
        "label": "data_dep: battle_session"
      },
      {
        "from": 37,
        "to": 38,
        "label": "data_dep: victory_condition"
      },
      {
        "from": 21,
        "to": 38,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 38,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 38,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 38,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 38,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 38,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 39,
        "label": "data_dep: battle_session"
      },
      {
        "from": 40,
        "to": 40,
        "label": "def: winner_address"
      },
      {
        "from": 21,
        "to": 40,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 40,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 40,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 40,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 41,
        "label": "data_dep: battle_session"
      },
      {
        "from": 21,
        "to": 42,
        "label": "data_dep: battle_session"
      }
    ]
  },
  {
    "name": "upgrade_warrior_equipment",
    "inputs": [
      "ctx: Context < UpgradeEquipment >",
      "warrior_id: u32",
      "equipment_type: EquipmentType",
      "upgrade_level: u8"
    ],
    "nodes": [
      {
        "id": 45,
        "label": "Entry"
      },
      {
        "id": 46,
        "label": "let warrior_owner = & mut ctx . accounts . warrior_owner ;"
      },
      {
        "id": 47,
        "label": "let equipment_forge = & ctx . accounts . equipment_forge ;"
      },
      {
        "id": 48,
        "label": "require ! (warrior_owner . warrior_tokens . contains (& warrior_id) , BattleError :: WarriorNotOwned) ;"
      },
      {
        "id": 49,
        "label": "let upgrade_cost_calculation = (upgrade_level as u64) * 500 ;"
      },
      {
        "id": 50,
        "label": "let equipment_multiplier = match equipment_type { EquipmentType :: Weapon => 3 , EquipmentType :: Armor => 2 , EquipmentType :: Accessory => 1 , } ;"
      },
      {
        "id": 51,
        "label": "let total_upgrade_cost = upgrade_cost_calculation * equipment_multiplier ;"
      },
      {
        "id": 52,
        "label": "require ! (warrior_owner . battle_tokens >= total_upgrade_cost , BattleError :: InsufficientUpgradeFunds) ;"
      },
      {
        "id": 53,
        "label": "warrior_owner . battle_tokens -= total_upgrade_cost ;"
      },
      {
        "id": 54,
        "label": "let equipment_bonus = upgrade_level as u32 * 25 ;"
      },
      {
        "id": 55,
        "label": "warrior_owner . total_warrior_power += equipment_bonus ;"
      },
      {
        "id": 56,
        "label": "let upgraded_equipment_id = warrior_id + (equipment_bonus * 1000) ;"
      },
      {
        "id": 57,
        "label": "warrior_owner . equipment_inventory . push (upgraded_equipment_id) ;"
      },
      {
        "id": 58,
        "label": "Ok (())"
      }
    ],
    "edges": [
      {
        "from": 46,
        "to": 46,
        "label": "def: warrior_owner"
      },
      {
        "from": 47,
        "to": 47,
        "label": "def: equipment_forge"
      },
      {
        "from": 49,
        "to": 49,
        "label": "def: upgrade_cost_calculation"
      },
      {
        "from": 50,
        "to": 50,
        "label": "def: equipment_multiplier"
      },
      {
        "from": 51,
        "to": 51,
        "label": "def: total_upgrade_cost"
      },
      {
        "from": 49,
        "to": 51,
        "label": "data_dep: upgrade_cost_calculation"
      },
      {
        "from": 50,
        "to": 51,
        "label": "data_dep: equipment_multiplier"
      },
      {
        "from": 46,
        "to": 53,
        "label": "data_dep: warrior_owner"
      },
      {
        "from": 51,
        "to": 53,
        "label": "data_dep: total_upgrade_cost"
      },
      {
        "from": 54,
        "to": 54,
        "label": "def: equipment_bonus"
      },
      {
        "from": 46,
        "to": 55,
        "label": "data_dep: warrior_owner"
      },
      {
        "from": 54,
        "to": 55,
        "label": "data_dep: equipment_bonus"
      },
      {
        "from": 56,
        "to": 56,
        "label": "def: upgraded_equipment_id"
      },
      {
        "from": 54,
        "to": 56,
        "label": "data_dep: equipment_bonus"
      },
      {
        "from": 46,
        "to": 57,
        "label": "data_dep: warrior_owner"
      },
      {
        "from": 56,
        "to": 57,
        "label": "data_dep: upgraded_equipment_id"
      }
    ]
  },
  {
    "name": "calculate_warrior_combat_rating",
    "inputs": [
      "warrior_id: u32"
    ],
    "nodes": [
      {
        "id": 59,
        "label": "Entry"
      },
      {
        "id": 60,
        "label": "let base_power = warrior_id % 1000 ;"
      },
      {
        "id": 61,
        "label": "let rarity_bonus = warrior_id / 10000 ;"
      },
      {
        "id": 62,
        "label": "base_power + (rarity_bonus * 50)"
      }
    ],
    "edges": [
      {
        "from": 60,
        "to": 60,
        "label": "def: base_power"
      },
      {
        "from": 61,
        "to": 61,
        "label": "def: rarity_bonus"
      },
      {
        "from": 60,
        "to": 62,
        "label": "data_dep: base_power"
      },
      {
        "from": 61,
        "to": 62,
        "label": "data_dep: rarity_bonus"
      }
    ]
  },
  {
    "name": "calculate_attack_damage",
    "inputs": [
      "warrior_id: u32",
      "strategy: AttackStrategy"
    ],
    "nodes": [
      {
        "id": 63,
        "label": "Entry"
      },
      {
        "id": 64,
        "label": "let base_damage = warrior_id % 100 ;"
      },
      {
        "id": 65,
        "label": "let strategy_modifier = match strategy { AttackStrategy :: Aggressive => base_damage + 20 , AttackStrategy :: Defensive => base_damage + 5 , AttackStrategy :: Balanced => base_damage + 12 , } ;"
      },
      {
        "id": 66,
        "label": "strategy_modifier"
      }
    ],
    "edges": [
      {
        "from": 64,
        "to": 64,
        "label": "def: base_damage"
      },
      {
        "from": 65,
        "to": 65,
        "label": "def: strategy_modifier"
      },
      {
        "from": 64,
        "to": 65,
        "label": "data_dep: base_damage"
      },
      {
        "from": 64,
        "to": 65,
        "label": "data_dep: base_damage"
      },
      {
        "from": 64,
        "to": 65,
        "label": "data_dep: base_damage"
      },
      {
        "from": 65,
        "to": 66,
        "label": "data_dep: strategy_modifier"
      }
    ]
  }
]