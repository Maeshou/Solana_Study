[
  {
    "name": "initialize_manager",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < InitManager >"
    ],
    "attributes": [
      "# [doc = \" マネージャー初期化：いくつかのクエスト ID を準備し、参加者・完了記録は容量だけ確保\"]",
      "# [doc = \" ⚠\\u{fe0f} `initializer` の署名チェックは一切行われない脆弱性あり\"]"
    ],
    "body": [
      "let mgr = & mut ctx . accounts . manager ;",
      "mgr . active_quests = (1 ..= 3) . collect () ;",
      "mgr . participants = Vec :: with_capacity (50) ;",
      "mgr . completions = Vec :: with_capacity (50) ;",
      "msg ! (\"Quest manager initialized with quests: {:?}\" , mgr . active_quests) ;"
    ]
  },
  {
    "name": "register_player",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < RegisterPlayer >"
    ],
    "attributes": [
      "# [doc = \" プレイヤー登録：任意のアカウントを参加者リストへ追加\"]",
      "# [doc = \" ⚠\\u{fe0f} `player` の署名チェックも所有者チェックも行われないため、誰でも誰を追加可能\"]"
    ],
    "body": [
      "let mgr = & mut ctx . accounts . manager ;",
      "mgr . participants . push (ctx . accounts . player . key ()) ;",
      "msg ! (\"Registered player: {}\" , ctx . accounts . player . key ()) ;"
    ]
  },
  {
    "name": "complete_quest",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < CompleteQuest >",
      "quest_id: u32"
    ],
    "attributes": [
      "# [doc = \" クエスト完了：指定クエストを完了記録し、未完了リストから削除\"]",
      "# [doc = \" ⚠\\u{fe0f} クエスト存在チェックや期限チェックもなく、誰でも任意の完了を記録可能\"]"
    ],
    "body": [
      "let mgr = & mut ctx . accounts . manager ;",
      "let now = Clock :: get () . unwrap () . unix_timestamp ;",
      "mgr . completions . push (Completion { player : ctx . accounts . player . key () , quest_id , timestamp : now , }) ;",
      "mgr . active_quests . retain (| & id | id != quest_id) ;",
      "msg ! (\"Player {} completed quest {}; remaining: {:?}\" , ctx . accounts . player . key () , quest_id , mgr . active_quests) ;"
    ]
  },
  {
    "name": "Manager",
    "node_type": "struct",
    "fields": [
      {
        "name": "active_quests",
        "attribute": "# [doc = \" まだ完了していないクエスト ID リスト\"]",
        "field_type": "Vec < u32 >"
      },
      {
        "name": "participants",
        "attribute": "# [doc = \" 登録されたプレイヤーの Pubkey リスト\"]",
        "field_type": "Vec < Pubkey >"
      },
      {
        "name": "completions",
        "attribute": "# [doc = \" 完了記録\"]",
        "field_type": "Vec < Completion >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Completion",
    "node_type": "struct",
    "fields": [
      {
        "name": "player",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "quest_id",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "timestamp",
        "attribute": null,
        "field_type": "i64"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "InitManager",
    "node_type": "struct",
    "fields": [
      {
        "name": "manager",
        "attribute": "# [account (init , payer = payer , space = 8 + (4 + 4 * 10) + (4 + 32 * 50) + (4 + (32 + 4 + 8) * 50))]",
        "field_type": "Account < 'info , Manager >"
      },
      {
        "name": "initializer",
        "attribute": "# [doc = \" CHECK: 初期化者の署名チェックなし\"]",
        "field_type": "UncheckedAccount < 'info >"
      },
      {
        "name": "payer",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "RegisterPlayer",
    "node_type": "struct",
    "fields": [
      {
        "name": "manager",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , Manager >"
      },
      {
        "name": "player",
        "attribute": "# [doc = \" CHECK: 署名チェックなしで任意の player を指定できる\"]",
        "field_type": "UncheckedAccount < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "CompleteQuest",
    "node_type": "struct",
    "fields": [
      {
        "name": "manager",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , Manager >"
      },
      {
        "name": "player",
        "attribute": "# [doc = \" CHECK: 署名検証なしで任意の player を指定可能\"]",
        "field_type": "UncheckedAccount < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]