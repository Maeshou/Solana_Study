[
  {
    "name": "log_access",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < LogAccess >",
      "duration_secs: u64",
      "rate: u64"
    ],
    "attributes": [
      "# [doc = \" サイト提供者向け：ユーザーの滞在秒数と提供者の NFT 保有量を\"]",
      "# [doc = \" 足し合わせた値にレートを掛けてトークンを付与します。\"]",
      "# [doc = \"\"]",
      "# [doc = \" - `duration_secs`: ユーザーがサイトに滞在した秒数  \"]",
      "# [doc = \" - `rate`: 足し合わせた値に対する付与レート  \"]",
      "# [doc = \" 署名チェックは一切ありません。分岐・ループも使わず算術演算のみ。\"]"
    ],
    "body": [
      "let nft_count = ctx . accounts . provider_hold . amount ;",
      "let sum = duration_secs . checked_add (nft_count) . unwrap_or (0) ;",
      "let to_award = sum . checked_mul (rate) . unwrap_or (0) ;",
      "let rec = & mut ctx . accounts . provider_reward ;",
      "rec . session_count = rec . session_count . saturating_add (1) ;",
      "rec . combined_total = rec . combined_total . saturating_add (sum) ;",
      "rec . total_awarded = rec . total_awarded . saturating_add (to_award) ;"
    ]
  },
  {
    "name": "LogAccess",
    "node_type": "struct",
    "fields": [
      {
        "name": "provider",
        "attribute": "# [doc = \" サイト提供者アカウント（署名チェック omitted intentionally）\"]",
        "field_type": "AccountInfo < 'info >"
      },
      {
        "name": "provider_hold",
        "attribute": "# [doc = \" 提供者の NFT 保有量参照用 TokenAccount\"] # [account (constraint = provider_hold . owner == * provider . key , constraint = provider_hold . mint == nft_mint . key ())]",
        "field_type": "Account < 'info , TokenAccount >"
      },
      {
        "name": "provider_reward",
        "attribute": "# [doc = \" 報酬累積用 PDA（事前に init 済み）\"] # [account (mut , seeds = [b\"site_reward\" , provider . key () . as_ref ()] , bump)]",
        "field_type": "Account < 'info , RewardRecord >"
      },
      {
        "name": "nft_mint",
        "attribute": "# [doc = \" 対象 NFT の Mint（参照用）\"]",
        "field_type": "AccountInfo < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "RewardRecord",
    "node_type": "struct",
    "fields": [
      {
        "name": "session_count",
        "attribute": "# [doc = \" ログ記録を行った回数\"]",
        "field_type": "u64"
      },
      {
        "name": "combined_total",
        "attribute": "# [doc = \" duration_secs + nft_count の累積合計\"]",
        "field_type": "u64"
      },
      {
        "name": "total_awarded",
        "attribute": "# [doc = \" 累積付与トークン量\"]",
        "field_type": "u64"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]