[
  {
    "name": "init_track",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < InitTrack >",
      "threshold: u32"
    ],
    "attributes": [],
    "body": [
      "let tracker = & mut ctx . accounts . tracker ;",
      "tracker . owner = ctx . accounts . owner . key () ;",
      "tracker . threshold = threshold ;",
      "tracker . total_events = 0 ;",
      "Ok (())"
    ]
  },
  {
    "name": "register_user",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < RegisterUser >",
      "lane: u8"
    ],
    "attributes": [],
    "body": [
      "let user = & mut ctx . accounts . user_card ;",
      "user . tracker = ctx . accounts . tracker . key () ;",
      "user . progress = 0 ;",
      "user . lane = lane ;",
      "Ok (())"
    ]
  },
  {
    "name": "audit_event",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < AuditEvent >",
      "deltas: Vec < i32 >"
    ],
    "attributes": [],
    "body": [
      "let user = & mut ctx . accounts . user_card ;",
      "let auditor = & mut ctx . accounts . auditor_card ;",
      "let tracker = & mut ctx . accounts . tracker ;",
      "let audit_log = & mut ctx . accounts . log ;",
      "let mut sum = 0i32 ;",
      "for d in deltas",
      "{",
      "sum = sum . saturating_add (d) ;",
      "}",
      "if sum > 0",
      "{",
      "user . progress = user . progress . saturating_add (sum as u32) ;",
      "tracker . total_events += 1 ;",
      "audit_log . note = 0xAB ;",
      "} else",
      "{",
      "auditor . progress = auditor . progress . saturating_sub ((- sum) as u32) ;",
      "tracker . total_events += 2 ;",
      "audit_log . note = 0xCD ;",
      "}",
      "Ok (())"
    ]
  },
  {
    "name": "InitTrack",
    "node_type": "struct",
    "fields": [
      {
        "name": "tracker",
        "attribute": "# [account (init , payer = owner , space = 8 + 32 + 4 + 4)]",
        "field_type": "Account < 'info , Tracker >"
      },
      {
        "name": "owner",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "RegisterUser",
    "node_type": "struct",
    "fields": [
      {
        "name": "user_card",
        "attribute": "# [account (init , payer = registrar , space = 8 + 32 + 1 + 4)]",
        "field_type": "Account < 'info , ProgressCard >"
      },
      {
        "name": "registrar",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "tracker",
        "attribute": null,
        "field_type": "Account < 'info , Tracker >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "AuditEvent",
    "node_type": "struct",
    "fields": [
      {
        "name": "tracker",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , Tracker >"
      },
      {
        "name": "user_card",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , ProgressCard >"
      },
      {
        "name": "auditor_card",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , ProgressCard >"
      },
      {
        "name": "log",
        "attribute": "# [account (init_if_needed , payer = auditor_signer , space = 8 + 1)]",
        "field_type": "Account < 'info , AuditLog >"
      },
      {
        "name": "auditor_signer",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Tracker",
    "node_type": "struct",
    "fields": [
      {
        "name": "owner",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "threshold",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "total_events",
        "attribute": null,
        "field_type": "u32"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "ProgressCard",
    "node_type": "struct",
    "fields": [
      {
        "name": "tracker",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "lane",
        "attribute": null,
        "field_type": "u8"
      },
      {
        "name": "progress",
        "attribute": null,
        "field_type": "u32"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "AuditLog",
    "node_type": "struct",
    "fields": [
      {
        "name": "note",
        "attribute": null,
        "field_type": "u8"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]