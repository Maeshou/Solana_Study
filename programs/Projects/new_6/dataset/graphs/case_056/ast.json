[
  {
    "name": "init_auction",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < InitAuction >",
      "starting_bid: u64",
      "duration_hours: u32"
    ],
    "attributes": [],
    "body": [
      "let auction = & mut ctx . accounts . auction ;",
      "auction . auctioneer = ctx . accounts . auctioneer . key () ;",
      "auction . item_id = Clock :: get () ? . unix_timestamp as u64 ;",
      "auction . starting_bid = starting_bid ;",
      "auction . current_bid = starting_bid ;",
      "auction . bid_count = 0 ;",
      "auction . end_time = Clock :: get () ? . unix_timestamp + (duration_hours as i64 * 3600) ;",
      "auction . is_active = true ;",
      "auction . reserve_met = false ;",
      "Ok (())"
    ]
  },
  {
    "name": "finalize_auction",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < FinalizeAuction >",
      "force_end: bool"
    ],
    "attributes": [],
    "body": [
      "let auction = & mut ctx . accounts . auction ;",
      "let finalizer = & ctx . accounts . finalizer ;",
      "let current_time = Clock :: get () ? . unix_timestamp ;",
      "if force_end || current_time >= auction . end_time",
      "{",
      "auction . is_active = false ;",
      "auction . finalized_at = current_time ;",
      "if auction . current_bid > auction . starting_bid",
      "{",
      "auction . winner = auction . highest_bidder ;",
      "auction . final_price = auction . current_bid ;",
      "let house_fee = (auction . current_bid * 250) / 10000 ;",
      "let seller_proceeds = auction . current_bid - house_fee ;",
      "auction . house_earnings += house_fee ;",
      "auction . seller_payout = seller_proceeds ;",
      "for i in 0 .. auction . bid_count . min (20)",
      "{",
      "if auction . bid_history [i as usize] . 0 != auction . highest_bidder { auction . pending_refunds [i as usize] = auction . bid_history [i as usize] . 1 ;",
      "} } } auction . total_volume += auction . current_bid ;",
      "}",
      "Ok (())"
    ]
  },
  {
    "name": "InitAuction",
    "node_type": "struct",
    "fields": [
      {
        "name": "auction",
        "attribute": "# [account (init , payer = auctioneer , space = 8 + 800)]",
        "field_type": "Account < 'info , AuctionData >"
      },
      {
        "name": "auctioneer",
        "attribute": "# [account (mut)]",
        "field_type": "AccountInfo < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "FinalizeAuction",
    "node_type": "struct",
    "fields": [
      {
        "name": "auction",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , AuctionData >"
      },
      {
        "name": "finalizer",
        "attribute": null,
        "field_type": "AccountInfo < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "AuctionData",
    "node_type": "struct",
    "fields": [
      {
        "name": "auctioneer",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "item_id",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "starting_bid",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "current_bid",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "highest_bidder",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "bid_count",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "end_time",
        "attribute": null,
        "field_type": "i64"
      },
      {
        "name": "finalized_at",
        "attribute": null,
        "field_type": "i64"
      },
      {
        "name": "is_active",
        "attribute": null,
        "field_type": "bool"
      },
      {
        "name": "reserve_met",
        "attribute": null,
        "field_type": "bool"
      },
      {
        "name": "winner",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "final_price",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "house_earnings",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "seller_payout",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "total_volume",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "bid_history",
        "attribute": null,
        "field_type": "[(Pubkey , u64) ; 20]"
      },
      {
        "name": "pending_refunds",
        "attribute": null,
        "field_type": "[u64 ; 20]"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]