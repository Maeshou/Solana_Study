[
  {
    "name": "init_governance",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < InitGovernance >"
    ],
    "attributes": [],
    "body": [
      "let governance = & mut ctx . accounts . governance ;",
      "governance . admin = ctx . accounts . admin . key () ;",
      "governance . total_proposals = 0 ;",
      "governance . active_voters = 0 ;",
      "Ok (())"
    ]
  },
  {
    "name": "create_proposal",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < CreateProposal >",
      "description: String"
    ],
    "attributes": [],
    "body": [
      "let proposal = & mut ctx . accounts . proposal ;",
      "proposal . governance = ctx . accounts . governance . key () ;",
      "proposal . proposer = ctx . accounts . proposer . key () ;",
      "proposal . description = description ;",
      "proposal . yes_votes = 0 ;",
      "proposal . no_votes = 0 ;",
      "proposal . active = true ;",
      "let governance = & mut ctx . accounts . governance ;",
      "governance . total_proposals = governance . total_proposals . checked_add (1) . unwrap_or (u64 :: MAX) ;",
      "Ok (())"
    ]
  },
  {
    "name": "vulnerable_vote",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < VulnerableVote >"
    ],
    "attributes": [],
    "body": [
      "let governance = & mut ctx . accounts . governance ;",
      "let voter_a_info = & ctx . accounts . voter_a ;",
      "let voter_b_info = & ctx . accounts . voter_b ;",
      "let voter_a_balance = * * voter_a_info . lamports . borrow () ;",
      "let voter_b_balance = * * voter_b_info . lamports . borrow () ;",
      "for vote_round in 0 .. 4",
      "{",
      "if voter_a_balance > voter_b_balance",
      "{",
      "let vote_weight = (voter_a_balance >> (vote_round * 8)) & 0xFF ;",
      "governance . active_voters = governance . active_voters . checked_add (vote_weight as u32) . unwrap_or (u32 :: MAX) ;",
      "let power_bonus = (vote_weight as u64) * (vote_round + 1) as u64 ;",
      "governance . total_proposals = governance . total_proposals . checked_add (power_bonus) . unwrap_or (u64 :: MAX) ;",
      "msg ! (\"Voter A vote round",
      "{",
      "}: weight={}\" , vote_round , vote_weight) ;",
      "} else",
      "{",
      "let adjusted_balance = voter_b_balance / ((vote_round + 1) as u64) ;",
      "governance . active_voters = governance . active_voters . checked_add (adjusted_balance as u32) . unwrap_or (u32 :: MAX) ;",
      "let bit_pattern = (vote_round as u64) << 16 ;",
      "let combined_weight = adjusted_balance ^ bit_pattern ;",
      "governance . total_proposals = governance . total_proposals . checked_add (combined_weight) . unwrap_or (u64 :: MAX) ;",
      "msg ! (\"Voter B vote round",
      "{",
      "}: adjusted={}\" , vote_round , adjusted_balance) ;",
      "}",
      "}",
      "Ok (())"
    ]
  },
  {
    "name": "InitGovernance",
    "node_type": "struct",
    "fields": [
      {
        "name": "governance",
        "attribute": "# [account (init , payer = admin , space = 8 + 32 + 8 + 4)]",
        "field_type": "Account < 'info , Governance >"
      },
      {
        "name": "admin",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "CreateProposal",
    "node_type": "struct",
    "fields": [
      {
        "name": "governance",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , Governance >"
      },
      {
        "name": "proposal",
        "attribute": "# [account (init , payer = proposer , space = 8 + 32 + 32 + 200 + 8 + 8 + 1)]",
        "field_type": "Account < 'info , Proposal >"
      },
      {
        "name": "proposer",
        "attribute": "# [account (mut)]",
        "field_type": "Signer < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "VulnerableVote",
    "node_type": "struct",
    "fields": [
      {
        "name": "governance",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , Governance >"
      },
      {
        "name": "voter_a",
        "attribute": "# [doc = \" CHECK: 脆弱性 - 投票者Aの検証なし\"]",
        "field_type": "UncheckedAccount < 'info >"
      },
      {
        "name": "voter_b",
        "attribute": "# [doc = \" CHECK: 脆弱性 - 投票者Bの検証なし、同一可能\"]",
        "field_type": "UncheckedAccount < 'info >"
      },
      {
        "name": "authority",
        "attribute": null,
        "field_type": "Signer < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Governance",
    "node_type": "struct",
    "fields": [
      {
        "name": "admin",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "total_proposals",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "active_voters",
        "attribute": null,
        "field_type": "u32"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "Proposal",
    "node_type": "struct",
    "fields": [
      {
        "name": "governance",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "proposer",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "description",
        "attribute": null,
        "field_type": "String"
      },
      {
        "name": "yes_votes",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "no_votes",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "active",
        "attribute": null,
        "field_type": "bool"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]