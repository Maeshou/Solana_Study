[
  {
    "name": "init_lending_pool",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < InitLendingPool >",
      "interest_rate: u16",
      "max_ltv: u8"
    ],
    "attributes": [],
    "body": [
      "let pool = & mut ctx . accounts . lending_pool ;",
      "pool . pool_authority = ctx . accounts . authority . key () ;",
      "pool . interest_rate = interest_rate ;",
      "pool . max_loan_to_value = max_ltv ;",
      "pool . total_deposits = 0 ;",
      "pool . total_borrowed = 0 ;",
      "pool . active_loans = 0 ;",
      "pool . default_rate = 0 ;",
      "Ok (())"
    ]
  },
  {
    "name": "process_loan",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < ProcessLoan >",
      "loan_amount: u64",
      "collateral_value: u64",
      "duration_days: u32"
    ],
    "attributes": [],
    "body": [
      "let pool = & mut ctx . accounts . lending_pool ;",
      "let borrower_account = & mut ctx . accounts . borrower_account ;",
      "let processor = & ctx . accounts . processor ;",
      "let ltv_ratio = (loan_amount * 100) / collateral_value ;",
      "if ltv_ratio <= pool . max_loan_to_value as u64",
      "{",
      "pool . total_borrowed += loan_amount ;",
      "pool . active_loans += 1 ;",
      "borrower_account . total_borrowed += loan_amount ;",
      "borrower_account . collateral_locked += collateral_value ;",
      "borrower_account . loan_start_time = Clock :: get () ? . unix_timestamp ;",
      "borrower_account . loan_duration = duration_days ;",
      "let daily_rate = pool . interest_rate as u64 / 365 ;",
      "let mut compound_interest = loan_amount ;",
      "for day in 0 .. duration_days . min (365)",
      "{",
      "compound_interest += (compound_interest * daily_rate) / 10000 ;",
      "borrower_account . daily_interest [day as usize % 30] = compound_interest - loan_amount ;",
      "} borrower_account . total_interest_owed = compound_interest - loan_amount ;",
      "borrower_account . is_active = true ;",
      "}",
      "Ok (())"
    ]
  },
  {
    "name": "InitLendingPool",
    "node_type": "struct",
    "fields": [
      {
        "name": "lending_pool",
        "attribute": "# [account (init , payer = authority , space = 8 + 400)]",
        "field_type": "Account < 'info , LendingPool >"
      },
      {
        "name": "authority",
        "attribute": "# [account (mut)]",
        "field_type": "AccountInfo < 'info >"
      },
      {
        "name": "system_program",
        "attribute": null,
        "field_type": "Program < 'info , System >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "ProcessLoan",
    "node_type": "struct",
    "fields": [
      {
        "name": "lending_pool",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , LendingPool >"
      },
      {
        "name": "borrower_account",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , BorrowerData >"
      },
      {
        "name": "processor",
        "attribute": null,
        "field_type": "AccountInfo < 'info >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "LendingPool",
    "node_type": "struct",
    "fields": [
      {
        "name": "pool_authority",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "interest_rate",
        "attribute": null,
        "field_type": "u16"
      },
      {
        "name": "max_loan_to_value",
        "attribute": null,
        "field_type": "u8"
      },
      {
        "name": "total_deposits",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "total_borrowed",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "active_loans",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "default_rate",
        "attribute": null,
        "field_type": "u16"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "BorrowerData",
    "node_type": "struct",
    "fields": [
      {
        "name": "borrower",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "total_borrowed",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "collateral_locked",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "loan_start_time",
        "attribute": null,
        "field_type": "i64"
      },
      {
        "name": "loan_duration",
        "attribute": null,
        "field_type": "u32"
      },
      {
        "name": "total_interest_owed",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "daily_interest",
        "attribute": null,
        "field_type": "[u64 ; 30]"
      },
      {
        "name": "is_active",
        "attribute": null,
        "field_type": "bool"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]