[
  {
    "name": "forge_nft",
    "node_type": "function",
    "fields": null,
    "inputs": [
      "ctx: Context < ForgeNft >",
      "material_score: u64",
      "inspiration: u8",
      "review_mode: bool"
    ],
    "attributes": [],
    "body": [
      "let forge = & mut ctx . accounts . nft_forge ;",
      "let crafter = & ctx . accounts . crafter ;",
      "let reviewer = & ctx . accounts . reviewer ;",
      "forge . review_mode = review_mode ;",
      "let now = Clock :: get () ? . unix_timestamp ;",
      "forge . last_forged = now ;",
      "forge . total_forgings += 1 ;",
      "let mut base_power = 10 ;",
      "let mut quality_multiplier = 1 ;",
      "if material_score > 500",
      "{",
      "base_power += 25 ;",
      "}",
      "if inspiration > 80",
      "{",
      "quality_multiplier = 3 ;",
      "}",
      "forge . power_score = base_power * quality_multiplier ;",
      "let record = & mut ctx . accounts . forge_log ;",
      "record . crafter = crafter . key () ;",
      "record . reviewer = reviewer . key () ;",
      "record . timestamp = now ;",
      "record . material_score = material_score ;",
      "record . inspiration = inspiration ;",
      "record . power_generated = forge . power_score ;",
      "record . review_mode_flag = review_mode ;",
      "if review_mode",
      "{",
      "forge . pending_review = true ;",
      "record . requires_review = true ;",
      "} else",
      "{",
      "forge . pending_review = false ;",
      "record . requires_review = false ;",
      "}",
      "let mut xp_gain = 5 ;",
      "if material_score > 1000",
      "{",
      "xp_gain += 10 ;",
      "}",
      "if inspiration > 90",
      "{",
      "xp_gain += 15 ;",
      "}",
      "forge . total_xp += xp_gain ;",
      "forge . recent_crafter = crafter . key () ;",
      "forge . last_material_hash = hashv (& [& material_score . to_le_bytes () , & inspiration . to_le_bytes ()]) . to_bytes () ;",
      "Ok (())"
    ]
  },
  {
    "name": "ForgeNft",
    "node_type": "struct",
    "fields": [
      {
        "name": "nft_forge",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , NftForgeState >"
      },
      {
        "name": "crafter",
        "attribute": null,
        "field_type": "AccountInfo < 'info >"
      },
      {
        "name": "reviewer",
        "attribute": null,
        "field_type": "AccountInfo < 'info >"
      },
      {
        "name": "forge_log",
        "attribute": "# [account (mut)]",
        "field_type": "Account < 'info , ForgeLog >"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "NftForgeState",
    "node_type": "struct",
    "fields": [
      {
        "name": "review_mode",
        "attribute": null,
        "field_type": "bool"
      },
      {
        "name": "pending_review",
        "attribute": null,
        "field_type": "bool"
      },
      {
        "name": "last_forged",
        "attribute": null,
        "field_type": "i64"
      },
      {
        "name": "total_forgings",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "power_score",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "total_xp",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "recent_crafter",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "last_material_hash",
        "attribute": null,
        "field_type": "[u8 ; 32]"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  },
  {
    "name": "ForgeLog",
    "node_type": "struct",
    "fields": [
      {
        "name": "crafter",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "reviewer",
        "attribute": null,
        "field_type": "Pubkey"
      },
      {
        "name": "timestamp",
        "attribute": null,
        "field_type": "i64"
      },
      {
        "name": "material_score",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "inspiration",
        "attribute": null,
        "field_type": "u8"
      },
      {
        "name": "power_generated",
        "attribute": null,
        "field_type": "u64"
      },
      {
        "name": "requires_review",
        "attribute": null,
        "field_type": "bool"
      },
      {
        "name": "review_mode_flag",
        "attribute": null,
        "field_type": "bool"
      }
    ],
    "inputs": null,
    "attributes": null,
    "body": null
  }
]